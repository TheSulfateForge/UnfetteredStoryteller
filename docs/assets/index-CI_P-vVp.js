(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _e=document.getElementById("landing-page"),ai=document.getElementById("landing-new-btn"),li=document.getElementById("landing-load-btn"),ci=document.getElementById("landing-settings-btn"),ui=document.getElementById("landing-credit-line"),st=document.getElementById("app"),F=document.getElementById("chat-log"),Fn=document.getElementById("chat-form"),me=document.getElementById("chat-input"),di=document.getElementById("loading"),$n=document.getElementById("settings-modal"),fi=document.getElementById("settings-form"),Me=document.getElementById("provider-selector"),Bn=document.getElementById("gemini-settings-section"),Ye=document.getElementById("api-key-input"),qn=document.getElementById("local-llm-settings-section"),Hn=document.getElementById("local-llm-url-input"),_t=document.getElementById("age-gate-modal"),pi=document.getElementById("age-gate-accept"),Mt=document.getElementById("age-gate-mature-toggle"),we=document.getElementById("load-game-modal"),te=document.getElementById("save-slots-list"),mi=document.getElementById("new-adventure-btn"),hi=document.getElementById("load-game-cancel-btn"),gi=document.getElementById("character-creation-cancel-btn"),yi=document.getElementById("change-settings-btn"),z=document.getElementById("read-aloud-toggle"),q=document.getElementById("mic-btn"),at=document.getElementById("character-creation-modal"),On=document.getElementById("character-form"),Yn=document.getElementById("char-name"),Ti=document.getElementById("char-desc"),Ci=document.getElementById("char-bio"),Jn=document.getElementById("story-hooks-modal"),ne=document.getElementById("story-hooks-container"),Kn=document.getElementById("custom-hook-form"),Ei=document.getElementById("custom-hook-input"),wt=document.getElementById("player-stats"),Wn=document.getElementById("stats-char-name"),zn=document.getElementById("stats-location"),Xn=document.getElementById("stats-health"),Qn=document.getElementById("stats-money"),Zn=document.getElementById("stats-exp"),de=document.getElementById("stats-pregnancy-status"),jn=document.getElementById("equip-weapon"),eo=document.getElementById("equip-armor"),to=document.getElementById("stats-inventory"),no=document.getElementById("stats-quests"),oo=document.getElementById("stats-party"),io=document.getElementById("stats-level"),ro=document.getElementById("stats-proficiency-bonus"),so=document.getElementById("stats-ac"),ao=document.getElementById("stats-speed"),lo=document.getElementById("stats-race"),co=document.getElementById("stats-class"),uo=document.getElementById("stats-background"),fo=document.getElementById("stats-alignment"),po=document.getElementById("stats-str"),mo=document.getElementById("stats-dex"),ho=document.getElementById("stats-con"),go=document.getElementById("stats-int"),yo=document.getElementById("stats-wis"),To=document.getElementById("stats-cha"),Co=document.getElementById("stats-str-mod"),Eo=document.getElementById("stats-dex-mod"),vo=document.getElementById("stats-con-mod"),So=document.getElementById("stats-int-mod"),Io=document.getElementById("stats-wis-mod"),Ao=document.getElementById("stats-cha-mod"),_o=document.getElementById("stats-skills"),Mo=document.getElementById("stats-saving-throws"),wo=document.getElementById("stats-feats"),Ro=document.getElementById("stats-racial-traits"),xo=document.getElementById("stats-class-features"),ie=document.getElementById("char-race"),re=document.getElementById("char-class"),se=document.getElementById("char-background"),vi=document.getElementById("char-alignment"),Si=document.getElementById("char-gender"),Ii=document.getElementById("legal-btn"),ue=document.getElementById("legal-modal"),Ai=document.getElementById("legal-modal-close-btn"),Rt=document.getElementById("rag-status"),Ee=document.getElementById("build-rag-btn"),_i=document.getElementById("points-remaining"),Mi=document.getElementById("point-buy-container");/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const W=["gemini-2.5-flash","gemma-3-27b-it","gemini-2.5-flash-lite","gemini-2.0-flash","gemini-2.0-flash-lite"],wi="en-GB",Ri="en-GB-Standard-A",oe="unfettered-storyteller-saves",Je="unfettered-storyteller-api-key",Po="unfettered-storyteller-provider-settings",xi=.2,No=8,lt=/\[ROLL\|([^|\]]+)\|([^|\]]*)(?:\|(ADVANTAGE|DISADVANTAGE|NONE))?\|?\]/g,ct=/\[ATTACK\|([^|\]]+)\|([^|\]]*)(?:\|(ADVANTAGE|DISADVANTAGE|NONE))?\|?\]/g,ut=/(?:\[?STATE_UPDATE\]?)\s*(\{[\s\S]*?\})\s*(?:\[\/?STATE_UPDATE\])?/ig,Re=/\[PIV_SEX\|([^|\]]+)\|([^|\]]+)\]/g,dt=/\[PREGNANCY_REVEALED\|([^\]]+)\]/g;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let ft=[],pt=[],mt=[],Do={},ko={};const Pi=()=>ft,Ni=()=>pt,Di=()=>mt,ki=()=>Do,Li=()=>ko;function ht(n){if(n)return pt.find(t=>t.name.toLowerCase()===n.toLowerCase())}function gt(n){if(n)return ft.find(t=>t.name.toLowerCase()===n.toLowerCase())}function yt(n){if(n)return mt.find(t=>t.name.toLowerCase()===n.toLowerCase())}async function bi(){try{const[n,t,e,o,i]=await Promise.all([fetch("/data/races.json"),fetch("/data/classes.json"),fetch("/data/backgrounds.json"),fetch("/data/weapons.json"),fetch("/data/armor.json")]),a=await n.json();ft=a.results||a;const l=await t.json();pt=l.results||l;const c=await e.json(),d=c.results||c;mt=[...new Map(d.map(h=>[h.name,h])).values()];const u=await o.json();(u.results||u).forEach(h=>{Do[h.name.toLowerCase()]=h});const p=await i.json();(p.results||p).forEach(h=>{ko[h.name.toLowerCase()]=h}),console.log("Game data loaded successfully.")}catch(n){console.error("Failed to load game data:",n)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ui={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",culture:"intelligence",deception:"charisma",engineering:"intelligence",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom",strength:"strength",dexterity:"dexterity",constitution:"constitution",intelligence:"intelligence",wisdom:"wisdom",charisma:"charisma"},Vi={acrobatics:"none",animalHandling:"none",arcana:"none",athletics:"none",culture:"none",deception:"none",engineering:"none",history:"none",insight:"none",intimidation:"none",investigation:"none",medicine:"none",nature:"none",perception:"none",performance:"none",persuasion:"none",religion:"none",sleightOfHand:"none",stealth:"none",survival:"none"},Gi={strength:"none",dexterity:"none",constitution:"none",intelligence:"none",wisdom:"none",charisma:"none"};function xe(n){switch(n){case 8:return-2;case 9:return-1;case 10:return 0;case 11:return 1;case 12:return 2;case 13:return 3;case 14:return 5;case 15:return 7;case 16:return 10;case 17:return 13;case 18:return 17;case 19:return 22;case 20:return 28;default:return 0}}function $(n){return Math.floor((n-10)/2)}function Fi(n){return Math.ceil(1+n/4)}function xt(n){if(n.includes("d")){const[t,e]=n.split("d").map(a=>parseInt(a,10));let o=0;const i=[];for(let a=0;a<t;a++){const l=Math.floor(Math.random()*e)+1;i.push(l),o+=l}return{rolls:i,total:o}}else{const t=parseInt(n,10);if(!isNaN(t))return{rolls:[t],total:t}}return{rolls:[0],total:0}}function $i(n){const t=ki();if(!n||!t)return null;const e=n.toLowerCase().replace(/\+\d+\s*/,"").trim(),i=Object.keys(t).filter(a=>e.includes(a)).sort((a,l)=>l.length-a.length)[0];return i?t[i]:null}function Bi(n){var u;const t=Li();if(!t)return 10+$(n.abilityScores.dexterity);const e=((u=n.equipment.armor)==null?void 0:u.toLowerCase())||"none",o=n.inventory.some(f=>f.toLowerCase().includes("shield"))||e.includes("shield");let i=10;const a=$(n.abilityScores.dexterity),c=Object.keys(t).filter(f=>e.includes(f)&&t[f].category!=="shield").sort((f,p)=>p.length-f.length)[0],d=c?t[c]:null;if(d){if(i=d.ac_base,d.ac_add_dexmod){const f=d.ac_cap_dexmod!==null?Math.min(a,d.ac_cap_dexmod):a;i+=f}}else i=10+a;return o&&(i+=2),i}function qi(n,t){const e=n.toLowerCase().replace(/\s/g,""),o=Ui[e];if(!o)return 0;const i=t.abilityScores[o],a=$(i);let l=0;return(Object.keys(t.skills).includes(e)&&t.skills[e]==="proficient"||Object.keys(t.savingThrows).includes(o)&&t.savingThrows[o]==="proficient")&&(l=t.proficiencyBonus),a+l}function Hi(n){const e=Fi(1),o={strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},i=8+$(o.constitution);return{name:n.name,backstory:n.bio,appearanceDescription:n.desc,alignment:n.alignment,health:{current:i,max:i},location:"A Bustling City",money:{amount:10,currency:"gp"},inventory:["Explorer's Pack"],equipment:{weapon:"Dagger",armor:"Leather Armor"},party:[],quests:[],exp:0,level:1,proficiencyBonus:e,armorClass:11+$(o.dexterity),speed:30,abilityScores:o,skills:{...Vi},savingThrows:{...Gi},feats:[],racialTraits:[],classFeatures:[],turnCount:0,pregnancy:null,npcStates:{}}}function Oi(n,t){if(!n.table)return[];const e=n.table.split(`
`).map(d=>d.trim()).filter(d=>d.startsWith("|"));if(e.length<3)return[];const i=e[0].split("|").map(d=>d.trim().toLowerCase()).indexOf("features");if(i===-1)return[];const a="1st",l=e.find(d=>{var f;return((f=d.split("|")[1])==null?void 0:f.trim().toLowerCase())===a});if(!l)return[];const c=l.split("|").map(d=>d.trim());return c.length>i?c[i].replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1").split(",").map(u=>u.trim()).filter(u=>u&&u!=="-"):[]}function Yi(n){switch(n.toLowerCase()){case"barbarian":return{equipment:{weapon:"Greataxe",armor:"No armor"},inventory:["Explorer's Pack","Four javelins"]};case"bard":return{equipment:{weapon:"Rapier",armor:"Leather Armor"},inventory:["Diplomat's Pack","Lute","Dagger"]};case"cleric":return{equipment:{weapon:"Mace",armor:"Scale Mail"},inventory:["Priest's Pack","Shield","Holy symbol"]};case"druid":return{equipment:{weapon:"Scimitar",armor:"Leather Armor"},inventory:["Explorer's Pack","Druidic focus","Shield"]};case"fighter":return{equipment:{weapon:"Longsword",armor:"Chain Mail"},inventory:["Explorer's Pack","Shield","Light crossbow","20 bolts"]};case"monk":return{equipment:{weapon:"Shortsword",armor:"No armor"},inventory:["Explorer's Pack","10 darts"]};case"paladin":return{equipment:{weapon:"Longsword",armor:"Chain Mail"},inventory:["Priest's Pack","Shield","Five javelins","Holy symbol"]};case"ranger":return{equipment:{weapon:"Longbow",armor:"Scale Mail"},inventory:["Explorer's Pack","Two shortswords","Quiver with 20 arrows"]};case"rogue":return{equipment:{weapon:"Rapier",armor:"Leather Armor"},inventory:["Burglar's Pack","Two daggers","Thieves' tools"]};case"sorcerer":return{equipment:{weapon:"Light crossbow",armor:"No armor"},inventory:["Explorer's Pack","Component pouch","Two daggers","20 bolts"]};case"warlock":return{equipment:{weapon:"Light crossbow",armor:"Leather Armor"},inventory:["Scholar's Pack","Component pouch","Two daggers","20 bolts"]};case"wizard":return{equipment:{weapon:"Quarterstaff",armor:"No armor"},inventory:["Scholar's Pack","Spellbook","Component pouch"]};default:return{equipment:{weapon:"Dagger",armor:"Leather Armor"},inventory:["Explorer's Pack"]}}}function Ji(n){var e;const t=(e=n.benefits)==null?void 0:e.find(o=>o.type==="equipment");return!t||!t.desc?[]:t.desc.replace(/\([^)]*\)/g,"").replace(/, and /g,",").replace(/\./g,"").split(",").map(o=>o.trim()).filter(Boolean)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ki(n,t){Wn.textContent=t.name,zn.textContent=n.location,Xn.textContent=`${n.health.current}/${n.health.max}`,Qn.textContent=`${n.money.amount} ${n.money.currency}`,Zn.textContent=`${n.exp} XP`}function Wi(n,t){var o;let e=0;if(t.gender==="female"&&((o=n.pregnancy)!=null&&o.isPregnant)){const i=Math.floor((n.turnCount-n.pregnancy.conceptionTurn)/No),a=Math.floor(i/7),l=de.querySelector("#stats-pregnancy-value");a>=14||n.pregnancy.knowledgeRevealed?(de.classList.remove("hidden"),a>=28?(e=10,l.innerHTML=`Pregnant (${a} weeks)<br><span class="penalty">Disadvantage on Str/Dex checks</span>`):l.textContent=`Pregnant (${a} weeks)`):de.classList.add("hidden")}else de.classList.add("hidden");return{speedPenalty:e}}function zi(n){jn.textContent=n.equipment.weapon||"None",eo.textContent=n.equipment.armor||"None";const t=o=>o.length>0?o.map(i=>`<li>${i}</li>`).join(""):"<li>(None)</li>";to.innerHTML=t(n.inventory),oo.innerHTML=t(n.party);const e=n.quests.map(o=>`<li><strong>${o.name}:</strong> ${o.description}</li>`);no.innerHTML=e.length>0?e.join(""):"<li>(None)</li>"}function Xi(n,t,e){io.textContent=String(n.level),ro.textContent=`+${n.proficiencyBonus}`,so.textContent=String(n.armorClass),ao.textContent=`${n.speed-e} ft.`,lo.textContent=t.race,co.textContent=t.characterClass,uo.textContent=t.background,fo.textContent=t.alignment}function Qi(n){const t=e=>{const o=$(e);return o>=0?`+${o}`:String(o)};po.textContent=String(n.abilityScores.strength),mo.textContent=String(n.abilityScores.dexterity),ho.textContent=String(n.abilityScores.constitution),go.textContent=String(n.abilityScores.intelligence),yo.textContent=String(n.abilityScores.wisdom),To.textContent=String(n.abilityScores.charisma),Co.textContent=t(n.abilityScores.strength),Eo.textContent=t(n.abilityScores.dexterity),vo.textContent=t(n.abilityScores.constitution),So.textContent=t(n.abilityScores.intelligence),Io.textContent=t(n.abilityScores.wisdom),Ao.textContent=t(n.abilityScores.charisma)}function Zi(n){const t=o=>o.length>0?o.map(i=>`<li>${i}</li>`).join(""):"<li>(None)</li>",e=o=>Object.entries(o).map(([i,a])=>`<li class="${a==="proficient"?"proficient":"not-proficient"}">${i.replace(/([A-Z])/g," $1")}</li>`).join("");_o.innerHTML=e(n.skills),Mo.innerHTML=e(n.savingThrows),wo.innerHTML=t(n.feats),Ro.innerHTML=t(n.racialTraits),xo.innerHTML=t(n.classFeatures)}function N(n,t){const e=document.createElement("div");e.classList.add("message");let o="";if(n==="dice"&&typeof t=="object"&&"dieValue"in t){const i=t;e.classList.add("dice-roll-message");const a=i.modifier>=0?"+":"-";let l=`Rolled ${i.roll} (d${i.dieValue}) ${a} ${Math.abs(i.modifier)}`;i.allRolls.length>1&&(l=`Rolled ${i.roll} from [${i.allRolls.join(", ")}] (d${i.dieValue}) ${a} ${Math.abs(i.modifier)}`),o=`<span class="dice-title">${i.description}</span><span class="dice-result">${i.total}</span><span class="dice-breakdown">${l}</span>`,i.rollModifier==="ADVANTAGE"?o+='<span class="advantage-notice">Rolled with Advantage</span>':i.rollModifier==="DISADVANTAGE"&&(o+='<span class="disadvantage-notice">Rolled with Disadvantage</span>'),e.dataset.skillOrAbility=i.skillOrAbility,e.dataset.description=i.description,i.rollModifier&&i.rollModifier!=="NONE"&&(e.dataset.modifier=i.rollModifier)}else if(n==="attack"&&typeof t=="object"&&"totalAttackRoll"in t){const i=t;e.classList.add("attack-roll-message");const a=i.attackBonus>=0?"+":"-",l=i.damageBonus>=0?"+":"-";let c=`${i.attackRoll} (d20) ${a} ${Math.abs(i.attackBonus)}`;i.allRolls.length>1&&(c=`${i.attackRoll} from [${i.allRolls.join(", ")}] (d20) ${a} ${Math.abs(i.attackBonus)}`),o=`
        <span class="attack-title">${i.description}</span>
        <div class="attack-results">
            <div class="result-box">
                <span class="result-label">Attack</span>
                <span class="result-value">${i.totalAttackRoll}</span>
                <span class="result-breakdown">${c}</span>
            </div>
            <div class="result-box">
                <span class="result-label">Damage</span>
                <span class="result-value">${i.totalDamage}</span>
                <span class="result-breakdown">${i.damageRoll} (${i.damageDice}) ${l} ${Math.abs(i.damageBonus)}</span>
            </div>
        </div>
    `,i.isCritical&&(o+='<div class="critical-hit">CRITICAL HIT!</div>'),i.rollModifier==="ADVANTAGE"?o+='<span class="advantage-notice">Rolled with Advantage</span>':i.rollModifier==="DISADVANTAGE"&&(o+='<span class="disadvantage-notice">Rolled with Disadvantage</span>')}else e.classList.add(`${n}-message`),o=(typeof t=="string"?t:"").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");return e.innerHTML=o,F.appendChild(e),Ue(),e}function Pe(n,t=n){di.classList.toggle("hidden",!t),me.disabled=n,Fn.querySelector('button[type="submit"]').disabled=n,q.disabled=n,document.querySelectorAll(".action-btn").forEach(e=>{e.disabled=n})}function Ue(){F.parentElement.scrollTop=F.parentElement.scrollHeight}function Tt(n,t){if(!n||!t||!n.health)return;Ki(n,t);const{speedPenalty:e}=Wi(n,t);zi(n),Xi(n,t,e),Qi(n),Zi(n)}function ji(){Wn.textContent="Character",zn.textContent="Unknown",Xn.textContent="--/--",Qn.textContent="--",Zn.textContent="--",de.classList.add("hidden"),jn.textContent="None",eo.textContent="None",to.innerHTML="<li>(Empty)</li>",no.innerHTML="<li>(None)</li>",oo.innerHTML="<li>(None)</li>",io.textContent="",ro.textContent="",so.textContent="",ao.textContent="",lo.textContent="",co.textContent="",uo.textContent="",fo.textContent="",po.textContent="",mo.textContent="",ho.textContent="",go.textContent="",yo.textContent="",To.textContent="",Co.textContent="",Eo.textContent="",vo.textContent="",So.textContent="",Io.textContent="",Ao.textContent="",_o.innerHTML="",Mo.innerHTML="",wo.innerHTML="<li>(None)</li>",Ro.innerHTML="<li>(None)</li>",xo.innerHTML="<li>(None)</li>"}function Pt(n,t){if(ne.innerHTML="",!n||n.length===0){ne.innerHTML='<p class="error-message">The Storyteller had trouble coming up with ideas. Please try writing your own, or <a href="#" onclick="location.reload()">restarting</a>.</p>';return}n.forEach(e=>{const o=document.createElement("div");o.className="story-hook-card",o.setAttribute("role","button"),o.tabIndex=0,o.innerHTML=`<h4>${e.title}</h4><p>${e.description}</p>`,o.addEventListener("click",()=>t(e.description)),o.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&t(e.description)}),ne.appendChild(o)})}function er(n){te.innerHTML="",n.length===0?te.innerHTML='<p class="no-saves">No adventures saved yet. Time to start one!</p>':n.forEach(t=>{if(!t||!t.characterInfo||!t.playerState){console.warn("Skipping rendering of a malformed save slot:",t);return}const e=document.createElement("div");e.className="save-slot-card",e.innerHTML=`
                <div class="save-slot-info">
                    <h4>${t.characterInfo.name}</h4>
                    <p>Level ${t.playerState.level} ${t.characterInfo.race} ${t.characterInfo.characterClass}</p>
                </div>
                <div class="save-slot-actions">
                    <button class="load-btn" data-id="${t.id}">Load</button>
                    <button class="delete-btn" data-id="${t.id}">Delete</button>
                </div>
            `,te.appendChild(e)}),we.classList.remove("hidden")}function tr(){at.classList.remove("hidden"),Yn.focus()}function fe(n){Me.value=n.provider,Ye.value=n.apiKey||"",Hn.value=n.localUrl||"";const t=n.provider==="local";Bn.classList.toggle("hidden",t),qn.classList.toggle("hidden",!t),$n.classList.remove("hidden"),Ye.focus()}function Ct(n,t){if(!Rt||!Ee)return;let e="",o=!1;switch(n){case"idle":e="Status: Not built. Click below to build.",o=!1;break;case"building":e=`Status: Building... ${t||""}`,o=!0;break;case"ready":e=`Status: Ready. ${t||""}`,o=!1,Ee.textContent="Rebuild Knowledge Base";break;case"error":e=`Status: Error. ${t||"An unknown error occurred."}`,o=!1;break;case"unsupported":e="Status: Unsupported by current AI Provider.",o=!0;break;case"initializing":e="Status: Initializing...",o=!0;break}Rt.textContent=e,Ee.disabled=o}function nr(){const n=Pi(),t=Ni(),e=Di(),o=new Map;n.forEach(l=>o.set(l.url,l));const i=n.map(l=>{let c=l.name;if(l.is_subrace&&l.subrace_of){const d=o.get(l.subrace_of);c=`${d?d.name:"Unknown"} (${l.name})`}return{value:l.name,text:c}});i.sort((l,c)=>l.text.localeCompare(c.text)),ie.innerHTML='<option value="" disabled selected>Select a Race...</option>';const a=document.createElement("optgroup");a.label="Available Races",i.forEach(l=>{const c=document.createElement("option");c.value=l.value,c.textContent=l.text,a.appendChild(c)}),ie.appendChild(a),re.innerHTML='<option value="" disabled selected>Select a Class...</option>',se.innerHTML='<option value="" disabled selected>Select a Background...</option>',t.forEach(l=>{const c=document.createElement("option");c.value=l.name,c.textContent=l.name,re.appendChild(c)}),e.forEach(l=>{const c=document.createElement("option");c.value=l.name,c.textContent=l.name,se.appendChild(c)})}function or(){const n=document.createElement("button");return n.className="regenerate-btn action-btn",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0-8 3.58-8-8 0-1.57-.46-3.03-1.24-4.26z"/></svg> Regenerate',n}function ir(n){console.log("UI: Rendering action choices:",n);const t=document.createElement("div");t.className="roll-request-container",n.forEach(e=>{const o=document.createElement("button");o.className="action-choice-btn",o.dataset.actionType=e.type,e.type==="attack"?(o.textContent=`Attack: ${e.targetDescription} with ${e.weaponName}`,o.dataset.weaponName=e.weaponName,o.dataset.targetDescription=e.targetDescription):(o.textContent=`${e.skillOrAbility}: ${e.description}`,o.dataset.skillOrAbility=e.skillOrAbility,o.dataset.description=e.description),e.modifier&&e.modifier!=="NONE"&&(o.textContent+=` (${e.modifier})`,o.dataset.modifier=e.modifier),t.appendChild(o)}),F.appendChild(t),Ue()}function rr(n){const t=n.previousElementSibling;if(t&&t.classList.contains("user-message")){const e=document.createElement("div");e.className="action-btn-container";const o=or();e.appendChild(o),n.insertAdjacentElement("afterend",e)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ve(n,t,e){return new Promise((o,i)=>{const a=setTimeout(()=>{i(new Error(e))},t);n.then(l=>{clearTimeout(a),o(l)},l=>{clearTimeout(a),i(l)})})}async function sr(n,t={},e=3e4){const o=new AbortController,i=setTimeout(()=>o.abort(),e),a=await fetch(n,{...t,signal:o.signal});return clearTimeout(i),a}function ar(n){let t="";for(let e=0;e<n.length;e+=2)t+=String.fromCharCode(parseInt(n.substr(e,2),16));return t}function lr(n){return n.replace(/(?:^\w|[A-Z]|\b\w)/g,(t,e)=>e===0?t.toLowerCase():t.toUpperCase()).replace(/\s+/g,"")}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Lo(n,t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const o=t[e];o&&typeof o=="object"&&!Array.isArray(o)?(n[e]||Object.assign(n,{[e]:{}}),Lo(n[e],o)):Object.assign(n,{[e]:o})}return n}const Nt={llmProvider:null,chat:null,characterInfo:null,playerState:null,chatHistory:[],isGenerating:!1,isMatureEnabled:!1,currentCharacterId:null};class cr{constructor(){this.state={...Nt}}getState(){return this.state}updateState(t){this.state={...this.state,...t}}updatePlayerState(t){this.state.playerState?Lo(this.state.playerState,t):this.updateState({playerState:t})}resetForNewGame(){const t=this.state.llmProvider;this.state={...Nt,llmProvider:t}}}const v=new cr;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ke(){const n=localStorage.getItem(Po);if(n)try{return JSON.parse(n)}catch(t){console.error("Could not parse provider settings, returning default.",t)}return{provider:"gemini",apiKey:localStorage.getItem(Je),localUrl:"http://127.0.0.1:11434/v1/chat/completions"}}function ur(n){localStorage.setItem(Po,JSON.stringify(n)),n.apiKey?localStorage.setItem(Je,n.apiKey):localStorage.removeItem(Je)}function he(){const n=localStorage.getItem(oe);if(!n)return[];try{const t=JSON.parse(n);return Array.isArray(t)?t.filter(e=>{const o=e&&typeof e=="object"&&e.characterInfo&&typeof e.characterInfo.name=="string"&&e.playerState&&typeof e.playerState.level=="number";return o||console.warn("Found and filtered an invalid save slot:",e),o}):(console.warn("Saved data in localStorage is not an array. Clearing it."),localStorage.removeItem(oe),[])}catch(t){return console.error("Error parsing saved games from localStorage. It might be corrupted. Clearing it.",t),localStorage.removeItem(oe),[]}}function bo(n){const t=he();t.push(n),localStorage.setItem(oe,JSON.stringify(t))}function dr(n,t){const e=he(),o=e.findIndex(i=>i.id===n);o>-1?(e[o]={...e[o],...t},localStorage.setItem(oe,JSON.stringify(e))):(console.warn("Attempted to update a save slot that doesn't exist. Creating a new one.",n),bo({id:n,...t}))}function fr(n){const t=he(),e=t.find(i=>i.id===n);if(!e)return!1;if(confirm(`Are you sure you want to permanently delete the adventure for "${e.characterInfo.name}"?`)){const i=t.filter(a=>a.id!==n);return localStorage.setItem(oe,JSON.stringify(i)),!0}return!1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let pr,mr;function hr(){return{geminiUrl:pr,vertexUrl:mr}}function gr(n,t,e){var o,i,a;if(!(!((o=n.httpOptions)===null||o===void 0)&&o.baseUrl)){const l=hr();return n.vertexai?(i=l.vertexUrl)!==null&&i!==void 0?i:t:(a=l.geminiUrl)!==null&&a!==void 0?a:e}return n.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ge{}function C(n,t){const e=/\{([^}]+)\}/g;return n.replace(e,(o,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){const a=t[i];return a!=null?String(a):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function s(n,t,e){for(let a=0;a<t.length-1;a++){const l=t[a];if(l.endsWith("[]")){const c=l.slice(0,-2);if(!(c in n))if(Array.isArray(e))n[c]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(n[c])){const d=n[c];if(Array.isArray(e))for(let u=0;u<d.length;u++){const f=d[u];s(f,t.slice(a+1),e[u])}else for(const u of d)s(u,t.slice(a+1),e)}return}else if(l.endsWith("[0]")){const c=l.slice(0,-3);c in n||(n[c]=[{}]);const d=n[c];s(d[0],t.slice(a+1),e);return}(!n[l]||typeof n[l]!="object")&&(n[l]={}),n=n[l]}const o=t[t.length-1],i=n[o];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${o}`)}else n[o]=e}function r(n,t){try{if(t.length===1&&t[0]==="_self")return n;for(let e=0;e<t.length;e++){if(typeof n!="object"||n===null)return;const o=t[e];if(o.endsWith("[]")){const i=o.slice(0,-2);if(i in n){const a=n[i];return Array.isArray(a)?a.map(l=>r(l,t.slice(e+1))):void 0}else return}else n=n[o]}return n}catch(e){if(e instanceof TypeError)return;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function w(n,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Uo(n,t){const e=w(n,t);return e?e.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:e.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${e}`:e:""}function Vo(n,t){return Array.isArray(t)?t.map(e=>Ne(n,e)):[Ne(n,t)]}function Ne(n,t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function yr(n,t){const e=Ne(n,t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Tr(n,t){const e=Ne(n,t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Dt(n,t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Go(n,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Dt(n,e)):[Dt(n,t)]}function We(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function kt(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Lt(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function P(n,t){if(t==null)throw new Error("ContentUnion is required");return We(t)?t:{role:"user",parts:Go(n,t)}}function Fo(n,t){if(!t)return[];if(n.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const o=P(n,e);return o.parts&&o.parts.length>0&&o.parts[0].text!==void 0?[o.parts[0].text]:[]});if(n.isVertexAI()){const e=P(n,t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>P(n,e)):[P(n,t)]}function O(n,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(kt(t)||Lt(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[P(n,t)]}const e=[],o=[],i=We(t[0]);for(const a of t){const l=We(a);if(l!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)e.push(a);else{if(kt(a)||Lt(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");o.push(a)}}return i||e.push({role:"user",parts:Go(n,o)}),e}function $o(n,t){return t}function Bo(n,t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Ve(n,t){return t}function Ge(n,t){if(!Array.isArray(t))throw new Error("tool is required and must be an array of Tools");return t}function Cr(n,t,e,o=1){const i=!t.startsWith(`${e}/`)&&t.split("/").length===o;return n.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${n.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function Y(n,t){if(typeof t!="string")throw new Error("name must be a string");return Cr(n,t,"cachedContents")}function qo(n,t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function J(n,t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function Er(n){return n!=null&&typeof n=="object"&&"name"in n}function vr(n){return n!=null&&typeof n=="object"&&"video"in n}function Sr(n){return n!=null&&typeof n=="object"&&"uri"in n}function Ho(n,t){var e;let o;if(Er(t)&&(o=t.name),!(Sr(t)&&(o=t.uri,o===void 0))&&!(vr(t)&&(o=(e=t.video)===null||e===void 0?void 0:e.uri,o===void 0))){if(typeof t=="string"&&(o=t),o===void 0)throw new Error("Could not extract file name from the provided input.");if(o.startsWith("https://")){const a=o.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${o}`);o=a[0]}else o.startsWith("files/")&&(o=o.split("files/")[1]);return o}}function Oo(n,t){let e;return n.isVertexAI()?e=t?"publishers/google/models":"models":e=t?"models":"tunedModels",e}function Yo(n,t){for(const e of["models","tunedModels","publisherModels"])if(Ir(t,e))return t[e];return[]}function Ir(n,t){return n!==null&&typeof n=="object"&&t in n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ar(n,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=r(t,["data"]);o!=null&&s(e,["data"],o);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function _r(n,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const o=r(t,["thought"]);o!=null&&s(e,["thought"],o);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],Ar(n,i));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function bt(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>_r(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Mr(){return{}}function wr(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Rr(n,t){const e={},o=r(t,["dynamicRetrievalConfig"]);return o!=null&&s(e,["dynamicRetrievalConfig"],wr(n,o)),e}function xr(n,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Mr());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],Rr(n,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const a=r(t,["codeExecution"]);a!=null&&s(e,["codeExecution"],a);const l=r(t,["functionDeclarations"]);return l!=null&&s(e,["functionDeclarations"],l),e}function Pr(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Nr(n,t){const e={},o=r(t,["functionCallingConfig"]);if(o!=null&&s(e,["functionCallingConfig"],Pr(n,o)),r(t,["retrievalConfig"])!==void 0)throw new Error("retrievalConfig parameter is not supported in Gemini API.");return e}function Dr(n,t,e){const o={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const a=r(t,["expireTime"]);e!==void 0&&a!=null&&s(e,["expireTime"],a);const l=r(t,["displayName"]);e!==void 0&&l!=null&&s(e,["displayName"],l);const c=r(t,["contents"]);if(e!==void 0&&c!=null){let p=O(n,c);Array.isArray(p)&&(p=p.map(m=>bt(n,m))),s(e,["contents"],p)}const d=r(t,["systemInstruction"]);e!==void 0&&d!=null&&s(e,["systemInstruction"],bt(n,P(n,d)));const u=r(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>xr(n,m))),s(e,["tools"],p)}const f=r(t,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],Nr(n,f)),o}function kr(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["model"],Uo(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],Dr(n,i,e)),e}function Lr(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","name"],Y(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function br(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","name"],Y(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Ur(n,t,e){const o={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const a=r(t,["expireTime"]);return e!==void 0&&a!=null&&s(e,["expireTime"],a),o}function Vr(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","name"],Y(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],Ur(n,i,e)),e}function Gr(n,t,e){const o={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const a=r(t,["pageToken"]);return e!==void 0&&a!=null&&s(e,["_query","pageToken"],a),o}function Fr(n,t){const e={},o=r(t,["config"]);return o!=null&&s(e,["config"],Gr(n,o,e)),e}function $r(n,t){const e={},o=r(t,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function Br(n,t){const e={},o=r(t,["videoMetadata"]);o!=null&&s(e,["videoMetadata"],o);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const a=r(t,["inlineData"]);a!=null&&s(e,["inlineData"],$r(n,a));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const c=r(t,["executableCode"]);c!=null&&s(e,["executableCode"],c);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function Ut(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Br(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function qr(){return{}}function Hr(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Or(n,t){const e={},o=r(t,["dynamicRetrievalConfig"]);return o!=null&&s(e,["dynamicRetrievalConfig"],Hr(n,o)),e}function Yr(){return{}}function Jr(n,t){const e={},o=r(t,["apiKeyString"]);return o!=null&&s(e,["apiKeyString"],o),e}function Kr(n,t){const e={},o=r(t,["apiKeyConfig"]);o!=null&&s(e,["apiKeyConfig"],Jr(n,o));const i=r(t,["authType"]);i!=null&&s(e,["authType"],i);const a=r(t,["googleServiceAccountConfig"]);a!=null&&s(e,["googleServiceAccountConfig"],a);const l=r(t,["httpBasicAuthConfig"]);l!=null&&s(e,["httpBasicAuthConfig"],l);const c=r(t,["oauthConfig"]);c!=null&&s(e,["oauthConfig"],c);const d=r(t,["oidcConfig"]);return d!=null&&s(e,["oidcConfig"],d),e}function Wr(n,t){const e={},o=r(t,["authConfig"]);return o!=null&&s(e,["authConfig"],Kr(n,o)),e}function zr(n,t){const e={},o=r(t,["retrieval"]);o!=null&&s(e,["retrieval"],o),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],qr());const a=r(t,["googleSearchRetrieval"]);a!=null&&s(e,["googleSearchRetrieval"],Or(n,a)),r(t,["enterpriseWebSearch"])!=null&&s(e,["enterpriseWebSearch"],Yr());const c=r(t,["googleMaps"]);c!=null&&s(e,["googleMaps"],Wr(n,c));const d=r(t,["codeExecution"]);d!=null&&s(e,["codeExecution"],d);const u=r(t,["functionDeclarations"]);return u!=null&&s(e,["functionDeclarations"],u),e}function Xr(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Qr(n,t){const e={},o=r(t,["latitude"]);o!=null&&s(e,["latitude"],o);const i=r(t,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function Zr(n,t){const e={},o=r(t,["latLng"]);return o!=null&&s(e,["latLng"],Qr(n,o)),e}function jr(n,t){const e={},o=r(t,["functionCallingConfig"]);o!=null&&s(e,["functionCallingConfig"],Xr(n,o));const i=r(t,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],Zr(n,i)),e}function es(n,t,e){const o={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const a=r(t,["expireTime"]);e!==void 0&&a!=null&&s(e,["expireTime"],a);const l=r(t,["displayName"]);e!==void 0&&l!=null&&s(e,["displayName"],l);const c=r(t,["contents"]);if(e!==void 0&&c!=null){let p=O(n,c);Array.isArray(p)&&(p=p.map(m=>Ut(n,m))),s(e,["contents"],p)}const d=r(t,["systemInstruction"]);e!==void 0&&d!=null&&s(e,["systemInstruction"],Ut(n,P(n,d)));const u=r(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>zr(n,m))),s(e,["tools"],p)}const f=r(t,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],jr(n,f)),o}function ts(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["model"],Uo(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],es(n,i,e)),e}function ns(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","name"],Y(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function os(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","name"],Y(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function is(n,t,e){const o={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const a=r(t,["expireTime"]);return e!==void 0&&a!=null&&s(e,["expireTime"],a),o}function rs(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","name"],Y(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],is(n,i,e)),e}function ss(n,t,e){const o={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const a=r(t,["pageToken"]);return e!==void 0&&a!=null&&s(e,["_query","pageToken"],a),o}function as(n,t){const e={},o=r(t,["config"]);return o!=null&&s(e,["config"],ss(n,o,e)),e}function Se(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const a=r(t,["model"]);a!=null&&s(e,["model"],a);const l=r(t,["createTime"]);l!=null&&s(e,["createTime"],l);const c=r(t,["updateTime"]);c!=null&&s(e,["updateTime"],c);const d=r(t,["expireTime"]);d!=null&&s(e,["expireTime"],d);const u=r(t,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function ls(){return{}}function cs(n,t){const e={},o=r(t,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(t,["cachedContents"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>Se(n,l))),s(e,["cachedContents"],a)}return e}function Ie(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const a=r(t,["model"]);a!=null&&s(e,["model"],a);const l=r(t,["createTime"]);l!=null&&s(e,["createTime"],l);const c=r(t,["updateTime"]);c!=null&&s(e,["updateTime"],c);const d=r(t,["expireTime"]);d!=null&&s(e,["expireTime"],d);const u=r(t,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function us(){return{}}function ds(n,t){const e={},o=r(t,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(t,["cachedContents"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>Ie(n,l))),s(e,["cachedContents"],a)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ae;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(ae||(ae={}));class Fe{constructor(t,e,o,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,o,i)}init(t,e,o){var i,a;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.idxInternal=0;let l={config:{}};o?typeof o=="object"?l=Object.assign({},o):l=o:l={config:{}},l.config&&(l.config.pageToken=e.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(a=(i=l.config)===null||i===void 0?void 0:i.pageSize)!==null&&a!==void 0?a:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Vt;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Vt||(Vt={}));var Gt;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Gt||(Gt={}));var X;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(X||(X={}));var Ft;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Ft||(Ft={}));var Q;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(Q||(Q={}));var $t;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})($t||($t={}));var Bt;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(Bt||(Bt={}));var y;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})(y||(y={}));var qt;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY"})(qt||(qt={}));var Ht;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(Ht||(Ht={}));var Ot;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Ot||(Ot={}));var Yt;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(Yt||(Yt={}));var Jt;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Jt||(Jt={}));var De;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(De||(De={}));var Kt;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Kt||(Kt={}));var ze;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(ze||(ze={}));var Wt;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Wt||(Wt={}));var zt;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(zt||(zt={}));var Xt;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Xt||(Xt={}));var Qt;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(Qt||(Qt={}));var Zt;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(Zt||(Zt={}));var jt;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(jt||(jt={}));var en;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi"})(en||(en={}));var tn;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(tn||(tn={}));var nn;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(nn||(nn={}));var on;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(on||(on={}));var rn;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(rn||(rn={}));var sn;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(sn||(sn={}));var an;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(an||(an={}));var ln;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(ln||(ln={}));var cn;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(cn||(cn={}));var un;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(un||(un={}));var dn;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(dn||(dn={}));var fn;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(fn||(fn={}));class ye{get text(){var t,e,o,i,a,l,c,d;if(((i=(o=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",f=!1;const p=[];for(const m of(d=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)!==null&&d!==void 0?d:[]){for(const[h,g]of Object.entries(m))h!=="text"&&h!=="thought"&&(g!==null||g!==void 0)&&p.push(h);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;f=!0,u+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?u:void 0}get data(){var t,e,o,i,a,l,c,d;if(((i=(o=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const f=[];for(const p of(d=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)!==null&&d!==void 0?d:[]){for(const[m,h]of Object.entries(p))m!=="inlineData"&&(h!==null||h!==void 0)&&f.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(u+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var t,e,o,i,a,l,c,d;if(((i=(o=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(d=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var t,e,o,i,a,l,c,d,u;if(((i=(o=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var t,e,o,i,a,l,c,d,u;if(((i=(o=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||o===void 0?void 0:o.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(c=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.output}}class pn{}class mn{}class fs{}class ps{}class hn{}class gn{}class yn{}class ms{}class Tn{}class Cn{}class En{}class hs{}class Xe{constructor(t){const e={};for(const o of t.headers.entries())e[o[0]]=o[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class gs{}class ys{}class Ts{get text(){var t,e,o;let i="",a=!1;const l=[];for(const c of(o=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&o!==void 0?o:[]){for(const[d,u]of Object.entries(c))d!=="text"&&d!=="thought"&&u!==null&&l.push(d);if(typeof c.text=="string"){if(typeof c.thought=="boolean"&&c.thought)continue;a=!0,i+=c.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),a?i:void 0}get data(){var t,e,o;let i="";const a=[];for(const l of(o=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&o!==void 0?o:[]){for(const[c,d]of Object.entries(l))c!=="inlineData"&&d!==null&&a.push(c);l.inlineData&&typeof l.inlineData.data=="string"&&(i+=atob(l.inlineData.data))}return a.length>0&&console.warn(`there are non-data parts ${a} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Cs extends ge{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new Fe(ae.PAGED_ITEM_CACHED_CONTENTS,o=>this.listInternal(o),await this.listInternal(e),e)}async create(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=ts(this.apiClient,t);return c=C("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Ie(this.apiClient,f))}else{const u=kr(this.apiClient,t);return c=C("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>Se(this.apiClient,f))}}async get(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=ns(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Ie(this.apiClient,f))}else{const u=Lr(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>Se(this.apiClient,f))}}async delete(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=os(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(()=>{const f=us(),p=new Cn;return Object.assign(p,f),p})}else{const u=br(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(()=>{const f=ls(),p=new Cn;return Object.assign(p,f),p})}}async update(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=rs(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Ie(this.apiClient,f))}else{const u=Vr(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>Se(this.apiClient,f))}}async listInternal(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=as(this.apiClient,t);return c=C("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const p=ds(this.apiClient,f),m=new En;return Object.assign(m,p),m})}else{const u=Fr(this.apiClient,t);return c=C("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>{const p=cs(this.apiClient,f),m=new En;return Object.assign(m,p),m})}}}function vn(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],o=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(n){return this instanceof x?(this.v=n,this):new x(n)}function ke(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=e.apply(n,t||[]),i,a=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",l),i[Symbol.asyncIterator]=function(){return this},i;function l(h){return function(g){return Promise.resolve(g).then(h,p)}}function c(h,g){o[h]&&(i[h]=function(T){return new Promise(function(E,I){a.push([h,T,E,I])>1||d(h,T)})},g&&(i[h]=g(i[h])))}function d(h,g){try{u(o[h](g))}catch(T){m(a[0][3],T)}}function u(h){h.value instanceof x?Promise.resolve(h.value.v).then(f,p):m(a[0][2],h)}function f(h){d("next",h)}function p(h){d("throw",h)}function m(h,g){h(g),a.shift(),a.length&&d(a[0][0],a[0][1])}}function Qe(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof vn=="function"?vn(n):n[Symbol.iterator](),e={},o("next"),o("throw"),o("return"),e[Symbol.asyncIterator]=function(){return this},e);function o(a){e[a]=n[a]&&function(l){return new Promise(function(c,d){l=n[a](l),i(c,d,l.done,l.value)})}}function i(a,l,c,d){Promise.resolve(d).then(function(u){a({value:u,done:c})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Es(n){var t;if(n.candidates==null||n.candidates.length===0)return!1;const e=(t=n.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:Jo(e)}function Jo(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const t of n.parts)if(t===void 0||Object.keys(t).length===0||t.text!==void 0&&t.text==="")return!1;return!0}function vs(n){if(n.length!==0){if(n[0].role!=="user")throw new Error("History must start with a user turn.");for(const t of n)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function Ss(n){if(n===void 0||n.length===0)return[];const t=[],e=n.length;let o=0,i=n[0];for(;o<e;)if(n[o].role==="user")i=n[o],o++;else{const a=[];let l=!0;for(;o<e&&n[o].role==="model";)a.push(n[o]),l&&!Jo(n[o])&&(l=!1),o++;l&&(t.push(i),t.push(...a))}return t}class Is{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new As(this.apiClient,this.modelsModule,t.model,t.config,t.history)}}class As{constructor(t,e,o,i={},a=[]){this.apiClient=t,this.modelsModule=e,this.model=o,this.config=i,this.history=a,this.sendPromise=Promise.resolve(),vs(a)}async sendMessage(t){var e;await this.sendPromise;const o=P(this.apiClient,t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(o),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var a,l;const d=(l=(a=(await i).candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content,u=d?[d]:[];this.recordHistory(o,u)})(),await this.sendPromise,i}async sendMessageStream(t){var e;await this.sendPromise;const o=P(this.apiClient,t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(o),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const a=await i;return this.processStreamResponse(a,o)}getHistory(t=!1){return t?Ss(this.history):this.history}processStreamResponse(t,e){var o,i;return ke(this,arguments,function*(){var l,c,d,u;const f=[];try{for(var p=!0,m=Qe(t),h;h=yield x(m.next()),l=h.done,!l;p=!0){u=h.value,p=!1;const g=u;if(Es(g)){const T=(i=(o=g.candidates)===null||o===void 0?void 0:o[0])===null||i===void 0?void 0:i.content;T!==void 0&&f.push(T)}yield yield x(g)}}catch(g){c={error:g}}finally{try{!p&&!l&&(d=m.return)&&(yield x(d.call(m)))}finally{if(c)throw c.error}}this.recordHistory(e,f)})}recordHistory(t,e){let o=[];e.length>0&&e.every(i=>i.role==="model")?o=e:o.push({role:"model",parts:[]}),this.history.push(t),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _s(n,t,e){const o={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const a=r(t,["pageToken"]);return e!==void 0&&a!=null&&s(e,["_query","pageToken"],a),o}function Ms(n,t){const e={},o=r(t,["config"]);return o!=null&&s(e,["config"],_s(n,o,e)),e}function ws(n,t){const e={},o=r(t,["details"]);o!=null&&s(e,["details"],o);const i=r(t,["message"]);i!=null&&s(e,["message"],i);const a=r(t,["code"]);return a!=null&&s(e,["code"],a),e}function Rs(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const a=r(t,["mimeType"]);a!=null&&s(e,["mimeType"],a);const l=r(t,["sizeBytes"]);l!=null&&s(e,["sizeBytes"],l);const c=r(t,["createTime"]);c!=null&&s(e,["createTime"],c);const d=r(t,["expirationTime"]);d!=null&&s(e,["expirationTime"],d);const u=r(t,["updateTime"]);u!=null&&s(e,["updateTime"],u);const f=r(t,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=r(t,["uri"]);p!=null&&s(e,["uri"],p);const m=r(t,["downloadUri"]);m!=null&&s(e,["downloadUri"],m);const h=r(t,["state"]);h!=null&&s(e,["state"],h);const g=r(t,["source"]);g!=null&&s(e,["source"],g);const T=r(t,["videoMetadata"]);T!=null&&s(e,["videoMetadata"],T);const E=r(t,["error"]);return E!=null&&s(e,["error"],ws(n,E)),e}function xs(n,t){const e={},o=r(t,["file"]);o!=null&&s(e,["file"],Rs(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Ps(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","file"],Ho(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Ns(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","file"],Ho(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Ds(n,t){const e={},o=r(t,["details"]);o!=null&&s(e,["details"],o);const i=r(t,["message"]);i!=null&&s(e,["message"],i);const a=r(t,["code"]);return a!=null&&s(e,["code"],a),e}function Ze(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const a=r(t,["mimeType"]);a!=null&&s(e,["mimeType"],a);const l=r(t,["sizeBytes"]);l!=null&&s(e,["sizeBytes"],l);const c=r(t,["createTime"]);c!=null&&s(e,["createTime"],c);const d=r(t,["expirationTime"]);d!=null&&s(e,["expirationTime"],d);const u=r(t,["updateTime"]);u!=null&&s(e,["updateTime"],u);const f=r(t,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=r(t,["uri"]);p!=null&&s(e,["uri"],p);const m=r(t,["downloadUri"]);m!=null&&s(e,["downloadUri"],m);const h=r(t,["state"]);h!=null&&s(e,["state"],h);const g=r(t,["source"]);g!=null&&s(e,["source"],g);const T=r(t,["videoMetadata"]);T!=null&&s(e,["videoMetadata"],T);const E=r(t,["error"]);return E!=null&&s(e,["error"],Ds(n,E)),e}function ks(n,t){const e={},o=r(t,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(t,["files"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>Ze(n,l))),s(e,["files"],a)}return e}function Ls(){return{}}function bs(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Us extends ge{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new Fe(ae.PAGED_ITEM_FILES,o=>this.listInternal(o),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>Ze(this.apiClient,e))}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Ms(this.apiClient,t);return a=C("files",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const u=ks(this.apiClient,d),f=new hs;return Object.assign(f,u),f})}}async createInternal(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=xs(this.apiClient,t);return a=C("upload/v1beta/files",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(()=>{const d=Ls(),u=new gs;return Object.assign(u,d),u})}}async get(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Ps(this.apiClient,t);return a=C("files/{file}",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>Ze(this.apiClient,d))}}async delete(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Ns(this.apiClient,t);return a=C("files/{file}",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(()=>{const d=bs(),u=new ys;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vs(n,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=r(t,["data"]);o!=null&&s(e,["data"],o);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Gs(n,t){const e={},o=r(t,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function Fs(n,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const o=r(t,["thought"]);o!=null&&s(e,["thought"],o);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],Vs(n,i));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function $s(n,t){const e={},o=r(t,["videoMetadata"]);o!=null&&s(e,["videoMetadata"],o);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const a=r(t,["inlineData"]);a!=null&&s(e,["inlineData"],Gs(n,a));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const c=r(t,["executableCode"]);c!=null&&s(e,["executableCode"],c);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function Bs(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Fs(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function qs(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>$s(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Hs(){return{}}function Os(){return{}}function Ys(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Js(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Ks(n,t){const e={},o=r(t,["dynamicRetrievalConfig"]);return o!=null&&s(e,["dynamicRetrievalConfig"],Ys(n,o)),e}function Ws(n,t){const e={},o=r(t,["dynamicRetrievalConfig"]);return o!=null&&s(e,["dynamicRetrievalConfig"],Js(n,o)),e}function zs(){return{}}function Xs(n,t){const e={},o=r(t,["apiKeyString"]);return o!=null&&s(e,["apiKeyString"],o),e}function Qs(n,t){const e={},o=r(t,["apiKeyConfig"]);o!=null&&s(e,["apiKeyConfig"],Xs(n,o));const i=r(t,["authType"]);i!=null&&s(e,["authType"],i);const a=r(t,["googleServiceAccountConfig"]);a!=null&&s(e,["googleServiceAccountConfig"],a);const l=r(t,["httpBasicAuthConfig"]);l!=null&&s(e,["httpBasicAuthConfig"],l);const c=r(t,["oauthConfig"]);c!=null&&s(e,["oauthConfig"],c);const d=r(t,["oidcConfig"]);return d!=null&&s(e,["oidcConfig"],d),e}function Zs(n,t){const e={},o=r(t,["authConfig"]);return o!=null&&s(e,["authConfig"],Qs(n,o)),e}function js(n,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Hs());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],Ks(n,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const a=r(t,["codeExecution"]);a!=null&&s(e,["codeExecution"],a);const l=r(t,["functionDeclarations"]);return l!=null&&s(e,["functionDeclarations"],l),e}function ea(n,t){const e={},o=r(t,["retrieval"]);o!=null&&s(e,["retrieval"],o),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Os());const a=r(t,["googleSearchRetrieval"]);a!=null&&s(e,["googleSearchRetrieval"],Ws(n,a)),r(t,["enterpriseWebSearch"])!=null&&s(e,["enterpriseWebSearch"],zs());const c=r(t,["googleMaps"]);c!=null&&s(e,["googleMaps"],Zs(n,c));const d=r(t,["codeExecution"]);d!=null&&s(e,["codeExecution"],d);const u=r(t,["functionDeclarations"]);return u!=null&&s(e,["functionDeclarations"],u),e}function ta(n,t){const e={},o=r(t,["handle"]);if(o!=null&&s(e,["handle"],o),r(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function na(n,t){const e={},o=r(t,["handle"]);o!=null&&s(e,["handle"],o);const i=r(t,["transparent"]);return i!=null&&s(e,["transparent"],i),e}function Sn(){return{}}function In(){return{}}function oa(n,t){const e={},o=r(t,["disabled"]);o!=null&&s(e,["disabled"],o);const i=r(t,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const a=r(t,["endOfSpeechSensitivity"]);a!=null&&s(e,["endOfSpeechSensitivity"],a);const l=r(t,["prefixPaddingMs"]);l!=null&&s(e,["prefixPaddingMs"],l);const c=r(t,["silenceDurationMs"]);return c!=null&&s(e,["silenceDurationMs"],c),e}function ia(n,t){const e={},o=r(t,["disabled"]);o!=null&&s(e,["disabled"],o);const i=r(t,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const a=r(t,["endOfSpeechSensitivity"]);a!=null&&s(e,["endOfSpeechSensitivity"],a);const l=r(t,["prefixPaddingMs"]);l!=null&&s(e,["prefixPaddingMs"],l);const c=r(t,["silenceDurationMs"]);return c!=null&&s(e,["silenceDurationMs"],c),e}function ra(n,t){const e={},o=r(t,["automaticActivityDetection"]);o!=null&&s(e,["automaticActivityDetection"],oa(n,o));const i=r(t,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const a=r(t,["turnCoverage"]);return a!=null&&s(e,["turnCoverage"],a),e}function sa(n,t){const e={},o=r(t,["automaticActivityDetection"]);o!=null&&s(e,["automaticActivityDetection"],ia(n,o));const i=r(t,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const a=r(t,["turnCoverage"]);return a!=null&&s(e,["turnCoverage"],a),e}function aa(n,t){const e={},o=r(t,["targetTokens"]);return o!=null&&s(e,["targetTokens"],o),e}function la(n,t){const e={},o=r(t,["targetTokens"]);return o!=null&&s(e,["targetTokens"],o),e}function ca(n,t){const e={},o=r(t,["triggerTokens"]);o!=null&&s(e,["triggerTokens"],o);const i=r(t,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],aa(n,i)),e}function ua(n,t){const e={},o=r(t,["triggerTokens"]);o!=null&&s(e,["triggerTokens"],o);const i=r(t,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],la(n,i)),e}function da(n,t,e){const o={},i=r(t,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const a=r(t,["responseModalities"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","responseModalities"],a);const l=r(t,["temperature"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","temperature"],l);const c=r(t,["topP"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topP"],c);const d=r(t,["topK"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","topK"],d);const u=r(t,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const f=r(t,["mediaResolution"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","mediaResolution"],f);const p=r(t,["seed"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","seed"],p);const m=r(t,["speechConfig"]);e!==void 0&&m!=null&&s(e,["setup","generationConfig","speechConfig"],m);const h=r(t,["systemInstruction"]);e!==void 0&&h!=null&&s(e,["setup","systemInstruction"],Bs(n,P(n,h)));const g=r(t,["tools"]);if(e!==void 0&&g!=null){let S=Ge(n,g);Array.isArray(S)&&(S=S.map(M=>js(n,Ve(n,M)))),s(e,["setup","tools"],S)}const T=r(t,["sessionResumption"]);e!==void 0&&T!=null&&s(e,["setup","sessionResumption"],ta(n,T));const E=r(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&s(e,["setup","inputAudioTranscription"],Sn());const I=r(t,["outputAudioTranscription"]);e!==void 0&&I!=null&&s(e,["setup","outputAudioTranscription"],Sn());const A=r(t,["realtimeInputConfig"]);e!==void 0&&A!=null&&s(e,["setup","realtimeInputConfig"],ra(n,A));const _=r(t,["contextWindowCompression"]);return e!==void 0&&_!=null&&s(e,["setup","contextWindowCompression"],ca(n,_)),o}function fa(n,t,e){const o={},i=r(t,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const a=r(t,["responseModalities"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","responseModalities"],a);const l=r(t,["temperature"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","temperature"],l);const c=r(t,["topP"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topP"],c);const d=r(t,["topK"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","topK"],d);const u=r(t,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const f=r(t,["mediaResolution"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","mediaResolution"],f);const p=r(t,["seed"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","seed"],p);const m=r(t,["speechConfig"]);e!==void 0&&m!=null&&s(e,["setup","generationConfig","speechConfig"],m);const h=r(t,["systemInstruction"]);e!==void 0&&h!=null&&s(e,["setup","systemInstruction"],qs(n,P(n,h)));const g=r(t,["tools"]);if(e!==void 0&&g!=null){let S=Ge(n,g);Array.isArray(S)&&(S=S.map(M=>ea(n,Ve(n,M)))),s(e,["setup","tools"],S)}const T=r(t,["sessionResumption"]);e!==void 0&&T!=null&&s(e,["setup","sessionResumption"],na(n,T));const E=r(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&s(e,["setup","inputAudioTranscription"],In());const I=r(t,["outputAudioTranscription"]);e!==void 0&&I!=null&&s(e,["setup","outputAudioTranscription"],In());const A=r(t,["realtimeInputConfig"]);e!==void 0&&A!=null&&s(e,["setup","realtimeInputConfig"],sa(n,A));const _=r(t,["contextWindowCompression"]);return e!==void 0&&_!=null&&s(e,["setup","contextWindowCompression"],ua(n,_)),o}function pa(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["setup","model"],w(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],da(n,i,e)),e}function ma(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["setup","model"],w(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],fa(n,i,e)),e}function ha(){return{}}function ga(){return{}}function ya(){return{}}function Ta(){return{}}function Ca(n,t){const e={},o=r(t,["media"]);o!=null&&s(e,["mediaChunks"],Vo(n,o));const i=r(t,["audio"]);i!=null&&s(e,["audio"],Tr(n,i));const a=r(t,["audioStreamEnd"]);a!=null&&s(e,["audioStreamEnd"],a);const l=r(t,["video"]);l!=null&&s(e,["video"],yr(n,l));const c=r(t,["text"]);return c!=null&&s(e,["text"],c),r(t,["activityStart"])!=null&&s(e,["activityStart"],ha()),r(t,["activityEnd"])!=null&&s(e,["activityEnd"],ya()),e}function Ea(n,t){const e={},o=r(t,["media"]);if(o!=null&&s(e,["mediaChunks"],Vo(n,o)),r(t,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=r(t,["audioStreamEnd"]);if(i!=null&&s(e,["audioStreamEnd"],i),r(t,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(r(t,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return r(t,["activityStart"])!=null&&s(e,["activityStart"],ga()),r(t,["activityEnd"])!=null&&s(e,["activityEnd"],Ta()),e}function va(){return{}}function Sa(){return{}}function Ia(n,t){const e={},o=r(t,["data"]);o!=null&&s(e,["data"],o);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Aa(n,t){const e={},o=r(t,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function _a(n,t){const e={},o=r(t,["thought"]);o!=null&&s(e,["thought"],o);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],Ia(n,i));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function Ma(n,t){const e={},o=r(t,["videoMetadata"]);o!=null&&s(e,["videoMetadata"],o);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const a=r(t,["inlineData"]);a!=null&&s(e,["inlineData"],Aa(n,a));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const c=r(t,["executableCode"]);c!=null&&s(e,["executableCode"],c);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function wa(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>_a(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Ra(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Ma(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function An(n,t){const e={},o=r(t,["text"]);o!=null&&s(e,["text"],o);const i=r(t,["finished"]);return i!=null&&s(e,["finished"],i),e}function _n(n,t){const e={},o=r(t,["text"]);o!=null&&s(e,["text"],o);const i=r(t,["finished"]);return i!=null&&s(e,["finished"],i),e}function xa(n,t){const e={},o=r(t,["modelTurn"]);o!=null&&s(e,["modelTurn"],wa(n,o));const i=r(t,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const a=r(t,["interrupted"]);a!=null&&s(e,["interrupted"],a);const l=r(t,["groundingMetadata"]);l!=null&&s(e,["groundingMetadata"],l);const c=r(t,["generationComplete"]);c!=null&&s(e,["generationComplete"],c);const d=r(t,["inputTranscription"]);d!=null&&s(e,["inputTranscription"],An(n,d));const u=r(t,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],An(n,u)),e}function Pa(n,t){const e={},o=r(t,["modelTurn"]);o!=null&&s(e,["modelTurn"],Ra(n,o));const i=r(t,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const a=r(t,["interrupted"]);a!=null&&s(e,["interrupted"],a);const l=r(t,["groundingMetadata"]);l!=null&&s(e,["groundingMetadata"],l);const c=r(t,["generationComplete"]);c!=null&&s(e,["generationComplete"],c);const d=r(t,["inputTranscription"]);d!=null&&s(e,["inputTranscription"],_n(n,d));const u=r(t,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],_n(n,u)),e}function Na(n,t){const e={},o=r(t,["id"]);o!=null&&s(e,["id"],o);const i=r(t,["args"]);i!=null&&s(e,["args"],i);const a=r(t,["name"]);return a!=null&&s(e,["name"],a),e}function Da(n,t){const e={},o=r(t,["args"]);o!=null&&s(e,["args"],o);const i=r(t,["name"]);return i!=null&&s(e,["name"],i),e}function ka(n,t){const e={},o=r(t,["functionCalls"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>Na(n,a))),s(e,["functionCalls"],i)}return e}function La(n,t){const e={},o=r(t,["functionCalls"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>Da(n,a))),s(e,["functionCalls"],i)}return e}function ba(n,t){const e={},o=r(t,["ids"]);return o!=null&&s(e,["ids"],o),e}function Ua(n,t){const e={},o=r(t,["ids"]);return o!=null&&s(e,["ids"],o),e}function Te(n,t){const e={},o=r(t,["modality"]);o!=null&&s(e,["modality"],o);const i=r(t,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function Ce(n,t){const e={},o=r(t,["modality"]);o!=null&&s(e,["modality"],o);const i=r(t,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function Va(n,t){const e={},o=r(t,["promptTokenCount"]);o!=null&&s(e,["promptTokenCount"],o);const i=r(t,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const a=r(t,["responseTokenCount"]);a!=null&&s(e,["responseTokenCount"],a);const l=r(t,["toolUsePromptTokenCount"]);l!=null&&s(e,["toolUsePromptTokenCount"],l);const c=r(t,["thoughtsTokenCount"]);c!=null&&s(e,["thoughtsTokenCount"],c);const d=r(t,["totalTokenCount"]);d!=null&&s(e,["totalTokenCount"],d);const u=r(t,["promptTokensDetails"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(g=>Te(n,g))),s(e,["promptTokensDetails"],h)}const f=r(t,["cacheTokensDetails"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(g=>Te(n,g))),s(e,["cacheTokensDetails"],h)}const p=r(t,["responseTokensDetails"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(g=>Te(n,g))),s(e,["responseTokensDetails"],h)}const m=r(t,["toolUsePromptTokensDetails"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(g=>Te(n,g))),s(e,["toolUsePromptTokensDetails"],h)}return e}function Ga(n,t){const e={},o=r(t,["promptTokenCount"]);o!=null&&s(e,["promptTokenCount"],o);const i=r(t,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const a=r(t,["candidatesTokenCount"]);a!=null&&s(e,["responseTokenCount"],a);const l=r(t,["toolUsePromptTokenCount"]);l!=null&&s(e,["toolUsePromptTokenCount"],l);const c=r(t,["thoughtsTokenCount"]);c!=null&&s(e,["thoughtsTokenCount"],c);const d=r(t,["totalTokenCount"]);d!=null&&s(e,["totalTokenCount"],d);const u=r(t,["promptTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(T=>Ce(n,T))),s(e,["promptTokensDetails"],g)}const f=r(t,["cacheTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(T=>Ce(n,T))),s(e,["cacheTokensDetails"],g)}const p=r(t,["candidatesTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(T=>Ce(n,T))),s(e,["responseTokensDetails"],g)}const m=r(t,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(T=>Ce(n,T))),s(e,["toolUsePromptTokensDetails"],g)}const h=r(t,["trafficType"]);return h!=null&&s(e,["trafficType"],h),e}function Fa(n,t){const e={},o=r(t,["timeLeft"]);return o!=null&&s(e,["timeLeft"],o),e}function $a(n,t){const e={},o=r(t,["timeLeft"]);return o!=null&&s(e,["timeLeft"],o),e}function Ba(n,t){const e={},o=r(t,["newHandle"]);o!=null&&s(e,["newHandle"],o);const i=r(t,["resumable"]);i!=null&&s(e,["resumable"],i);const a=r(t,["lastConsumedClientMessageIndex"]);return a!=null&&s(e,["lastConsumedClientMessageIndex"],a),e}function qa(n,t){const e={},o=r(t,["newHandle"]);o!=null&&s(e,["newHandle"],o);const i=r(t,["resumable"]);i!=null&&s(e,["resumable"],i);const a=r(t,["lastConsumedClientMessageIndex"]);return a!=null&&s(e,["lastConsumedClientMessageIndex"],a),e}function Ha(n,t){const e={};r(t,["setupComplete"])!=null&&s(e,["setupComplete"],va());const i=r(t,["serverContent"]);i!=null&&s(e,["serverContent"],xa(n,i));const a=r(t,["toolCall"]);a!=null&&s(e,["toolCall"],ka(n,a));const l=r(t,["toolCallCancellation"]);l!=null&&s(e,["toolCallCancellation"],ba(n,l));const c=r(t,["usageMetadata"]);c!=null&&s(e,["usageMetadata"],Va(n,c));const d=r(t,["goAway"]);d!=null&&s(e,["goAway"],Fa(n,d));const u=r(t,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],Ba(n,u)),e}function Oa(n,t){const e={};r(t,["setupComplete"])!=null&&s(e,["setupComplete"],Sa());const i=r(t,["serverContent"]);i!=null&&s(e,["serverContent"],Pa(n,i));const a=r(t,["toolCall"]);a!=null&&s(e,["toolCall"],La(n,a));const l=r(t,["toolCallCancellation"]);l!=null&&s(e,["toolCallCancellation"],Ua(n,l));const c=r(t,["usageMetadata"]);c!=null&&s(e,["usageMetadata"],Ga(n,c));const d=r(t,["goAway"]);d!=null&&s(e,["goAway"],$a(n,d));const u=r(t,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],qa(n,u)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ya(n,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=r(t,["data"]);o!=null&&s(e,["data"],o);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Ja(n,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const o=r(t,["thought"]);o!=null&&s(e,["thought"],o);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],Ya(n,i));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function $e(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Ja(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Ka(n,t){const e={};if(r(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const o=r(t,["category"]);o!=null&&s(e,["category"],o);const i=r(t,["threshold"]);return i!=null&&s(e,["threshold"],i),e}function Wa(){return{}}function za(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Xa(n,t){const e={},o=r(t,["dynamicRetrievalConfig"]);return o!=null&&s(e,["dynamicRetrievalConfig"],za(n,o)),e}function Qa(n,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Wa());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],Xa(n,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const a=r(t,["codeExecution"]);a!=null&&s(e,["codeExecution"],a);const l=r(t,["functionDeclarations"]);return l!=null&&s(e,["functionDeclarations"],l),e}function Za(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function ja(n,t){const e={},o=r(t,["functionCallingConfig"]);if(o!=null&&s(e,["functionCallingConfig"],Za(n,o)),r(t,["retrievalConfig"])!==void 0)throw new Error("retrievalConfig parameter is not supported in Gemini API.");return e}function el(n,t){const e={},o=r(t,["voiceName"]);return o!=null&&s(e,["voiceName"],o),e}function tl(n,t){const e={},o=r(t,["prebuiltVoiceConfig"]);return o!=null&&s(e,["prebuiltVoiceConfig"],el(n,o)),e}function nl(n,t){const e={},o=r(t,["voiceConfig"]);o!=null&&s(e,["voiceConfig"],tl(n,o));const i=r(t,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function ol(n,t){const e={},o=r(t,["includeThoughts"]);o!=null&&s(e,["includeThoughts"],o);const i=r(t,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function il(n,t,e){const o={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],$e(n,P(n,i)));const a=r(t,["temperature"]);a!=null&&s(o,["temperature"],a);const l=r(t,["topP"]);l!=null&&s(o,["topP"],l);const c=r(t,["topK"]);c!=null&&s(o,["topK"],c);const d=r(t,["candidateCount"]);d!=null&&s(o,["candidateCount"],d);const u=r(t,["maxOutputTokens"]);u!=null&&s(o,["maxOutputTokens"],u);const f=r(t,["stopSequences"]);f!=null&&s(o,["stopSequences"],f);const p=r(t,["responseLogprobs"]);p!=null&&s(o,["responseLogprobs"],p);const m=r(t,["logprobs"]);m!=null&&s(o,["logprobs"],m);const h=r(t,["presencePenalty"]);h!=null&&s(o,["presencePenalty"],h);const g=r(t,["frequencyPenalty"]);g!=null&&s(o,["frequencyPenalty"],g);const T=r(t,["seed"]);T!=null&&s(o,["seed"],T);const E=r(t,["responseMimeType"]);E!=null&&s(o,["responseMimeType"],E);const I=r(t,["responseSchema"]);if(I!=null&&s(o,["responseSchema"],$o(n,I)),r(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const A=r(t,["safetySettings"]);if(e!==void 0&&A!=null){let D=A;Array.isArray(D)&&(D=D.map(ee=>Ka(n,ee))),s(e,["safetySettings"],D)}const _=r(t,["tools"]);if(e!==void 0&&_!=null){let D=Ge(n,_);Array.isArray(D)&&(D=D.map(ee=>Qa(n,Ve(n,ee)))),s(e,["tools"],D)}const S=r(t,["toolConfig"]);if(e!==void 0&&S!=null&&s(e,["toolConfig"],ja(n,S)),r(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const M=r(t,["cachedContent"]);e!==void 0&&M!=null&&s(e,["cachedContent"],Y(n,M));const B=r(t,["responseModalities"]);B!=null&&s(o,["responseModalities"],B);const U=r(t,["mediaResolution"]);U!=null&&s(o,["mediaResolution"],U);const K=r(t,["speechConfig"]);if(K!=null&&s(o,["speechConfig"],nl(n,Bo(n,K))),r(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const V=r(t,["thinkingConfig"]);return V!=null&&s(o,["thinkingConfig"],ol(n,V)),o}function Mn(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["contents"]);if(i!=null){let l=O(n,i);Array.isArray(l)&&(l=l.map(c=>$e(n,c))),s(e,["contents"],l)}const a=r(t,["config"]);return a!=null&&s(e,["generationConfig"],il(n,a,e)),e}function rl(n,t,e){const o={},i=r(t,["taskType"]);e!==void 0&&i!=null&&s(e,["requests[]","taskType"],i);const a=r(t,["title"]);e!==void 0&&a!=null&&s(e,["requests[]","title"],a);const l=r(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&s(e,["requests[]","outputDimensionality"],l),r(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function sl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["contents"]);i!=null&&s(e,["requests[]","content"],Fo(n,i));const a=r(t,["config"]);a!=null&&s(e,["config"],rl(n,a,e));const l=r(t,["model"]);return l!==void 0&&s(e,["requests[]","model"],w(n,l)),e}function al(n,t,e){const o={};if(r(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=r(t,["numberOfImages"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const a=r(t,["aspectRatio"]);e!==void 0&&a!=null&&s(e,["parameters","aspectRatio"],a);const l=r(t,["guidanceScale"]);if(e!==void 0&&l!=null&&s(e,["parameters","guidanceScale"],l),r(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=r(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&s(e,["parameters","safetySetting"],c);const d=r(t,["personGeneration"]);e!==void 0&&d!=null&&s(e,["parameters","personGeneration"],d);const u=r(t,["includeSafetyAttributes"]);e!==void 0&&u!=null&&s(e,["parameters","includeSafetyAttributes"],u);const f=r(t,["includeRaiReason"]);e!==void 0&&f!=null&&s(e,["parameters","includeRaiReason"],f);const p=r(t,["language"]);e!==void 0&&p!=null&&s(e,["parameters","language"],p);const m=r(t,["outputMimeType"]);e!==void 0&&m!=null&&s(e,["parameters","outputOptions","mimeType"],m);const h=r(t,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&s(e,["parameters","outputOptions","compressionQuality"],h),r(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(r(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return o}function ll(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const a=r(t,["config"]);return a!=null&&s(e,["config"],al(n,a,e)),e}function cl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","name"],w(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function ul(n,t,e){const o={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const a=r(t,["pageToken"]);e!==void 0&&a!=null&&s(e,["_query","pageToken"],a);const l=r(t,["filter"]);e!==void 0&&l!=null&&s(e,["_query","filter"],l);const c=r(t,["queryBase"]);return e!==void 0&&c!=null&&s(e,["_url","models_url"],Oo(n,c)),o}function dl(n,t){const e={},o=r(t,["config"]);return o!=null&&s(e,["config"],ul(n,o,e)),e}function fl(n,t,e){const o={},i=r(t,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const a=r(t,["description"]);e!==void 0&&a!=null&&s(e,["description"],a);const l=r(t,["defaultCheckpointId"]);return e!==void 0&&l!=null&&s(e,["defaultCheckpointId"],l),o}function pl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","name"],w(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],fl(n,i,e)),e}function ml(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","name"],w(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function hl(n,t){const e={};if(r(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function gl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["contents"]);if(i!=null){let l=O(n,i);Array.isArray(l)&&(l=l.map(c=>$e(n,c))),s(e,["contents"],l)}const a=r(t,["config"]);return a!=null&&s(e,["config"],hl(n,a)),e}function yl(n,t){const e={};if(r(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const o=r(t,["imageBytes"]);o!=null&&s(e,["bytesBase64Encoded"],J(n,o));const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Tl(n,t,e){const o={},i=r(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i),r(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=r(t,["durationSeconds"]);if(e!==void 0&&a!=null&&s(e,["parameters","durationSeconds"],a),r(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=r(t,["aspectRatio"]);if(e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l),r(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const c=r(t,["personGeneration"]);if(e!==void 0&&c!=null&&s(e,["parameters","personGeneration"],c),r(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=r(t,["negativePrompt"]);if(e!==void 0&&d!=null&&s(e,["parameters","negativePrompt"],d),r(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return o}function Cl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const a=r(t,["image"]);a!=null&&s(e,["instances[0]","image"],yl(n,a));const l=r(t,["config"]);return l!=null&&s(e,["config"],Tl(n,l,e)),e}function El(n,t){const e={},o=r(t,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function vl(n,t){const e={},o=r(t,["videoMetadata"]);o!=null&&s(e,["videoMetadata"],o);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const a=r(t,["inlineData"]);a!=null&&s(e,["inlineData"],El(n,a));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const c=r(t,["executableCode"]);c!=null&&s(e,["executableCode"],c);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function ce(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>vl(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Sl(n,t){const e={},o=r(t,["featureSelectionPreference"]);return o!=null&&s(e,["featureSelectionPreference"],o),e}function Il(n,t){const e={},o=r(t,["method"]);o!=null&&s(e,["method"],o);const i=r(t,["category"]);i!=null&&s(e,["category"],i);const a=r(t,["threshold"]);return a!=null&&s(e,["threshold"],a),e}function Al(){return{}}function _l(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Ml(n,t){const e={},o=r(t,["dynamicRetrievalConfig"]);return o!=null&&s(e,["dynamicRetrievalConfig"],_l(n,o)),e}function wl(){return{}}function Rl(n,t){const e={},o=r(t,["apiKeyString"]);return o!=null&&s(e,["apiKeyString"],o),e}function xl(n,t){const e={},o=r(t,["apiKeyConfig"]);o!=null&&s(e,["apiKeyConfig"],Rl(n,o));const i=r(t,["authType"]);i!=null&&s(e,["authType"],i);const a=r(t,["googleServiceAccountConfig"]);a!=null&&s(e,["googleServiceAccountConfig"],a);const l=r(t,["httpBasicAuthConfig"]);l!=null&&s(e,["httpBasicAuthConfig"],l);const c=r(t,["oauthConfig"]);c!=null&&s(e,["oauthConfig"],c);const d=r(t,["oidcConfig"]);return d!=null&&s(e,["oidcConfig"],d),e}function Pl(n,t){const e={},o=r(t,["authConfig"]);return o!=null&&s(e,["authConfig"],xl(n,o)),e}function Ko(n,t){const e={},o=r(t,["retrieval"]);o!=null&&s(e,["retrieval"],o),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Al());const a=r(t,["googleSearchRetrieval"]);a!=null&&s(e,["googleSearchRetrieval"],Ml(n,a)),r(t,["enterpriseWebSearch"])!=null&&s(e,["enterpriseWebSearch"],wl());const c=r(t,["googleMaps"]);c!=null&&s(e,["googleMaps"],Pl(n,c));const d=r(t,["codeExecution"]);d!=null&&s(e,["codeExecution"],d);const u=r(t,["functionDeclarations"]);return u!=null&&s(e,["functionDeclarations"],u),e}function Nl(n,t){const e={},o=r(t,["mode"]);o!=null&&s(e,["mode"],o);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Dl(n,t){const e={},o=r(t,["latitude"]);o!=null&&s(e,["latitude"],o);const i=r(t,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function kl(n,t){const e={},o=r(t,["latLng"]);return o!=null&&s(e,["latLng"],Dl(n,o)),e}function Ll(n,t){const e={},o=r(t,["functionCallingConfig"]);o!=null&&s(e,["functionCallingConfig"],Nl(n,o));const i=r(t,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],kl(n,i)),e}function bl(n,t){const e={},o=r(t,["voiceName"]);return o!=null&&s(e,["voiceName"],o),e}function Ul(n,t){const e={},o=r(t,["prebuiltVoiceConfig"]);return o!=null&&s(e,["prebuiltVoiceConfig"],bl(n,o)),e}function Vl(n,t){const e={},o=r(t,["voiceConfig"]);o!=null&&s(e,["voiceConfig"],Ul(n,o));const i=r(t,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function Gl(n,t){const e={},o=r(t,["includeThoughts"]);o!=null&&s(e,["includeThoughts"],o);const i=r(t,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function Fl(n,t,e){const o={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],ce(n,P(n,i)));const a=r(t,["temperature"]);a!=null&&s(o,["temperature"],a);const l=r(t,["topP"]);l!=null&&s(o,["topP"],l);const c=r(t,["topK"]);c!=null&&s(o,["topK"],c);const d=r(t,["candidateCount"]);d!=null&&s(o,["candidateCount"],d);const u=r(t,["maxOutputTokens"]);u!=null&&s(o,["maxOutputTokens"],u);const f=r(t,["stopSequences"]);f!=null&&s(o,["stopSequences"],f);const p=r(t,["responseLogprobs"]);p!=null&&s(o,["responseLogprobs"],p);const m=r(t,["logprobs"]);m!=null&&s(o,["logprobs"],m);const h=r(t,["presencePenalty"]);h!=null&&s(o,["presencePenalty"],h);const g=r(t,["frequencyPenalty"]);g!=null&&s(o,["frequencyPenalty"],g);const T=r(t,["seed"]);T!=null&&s(o,["seed"],T);const E=r(t,["responseMimeType"]);E!=null&&s(o,["responseMimeType"],E);const I=r(t,["responseSchema"]);I!=null&&s(o,["responseSchema"],$o(n,I));const A=r(t,["routingConfig"]);A!=null&&s(o,["routingConfig"],A);const _=r(t,["modelSelectionConfig"]);_!=null&&s(o,["modelConfig"],Sl(n,_));const S=r(t,["safetySettings"]);if(e!==void 0&&S!=null){let G=S;Array.isArray(G)&&(G=G.map(qe=>Il(n,qe))),s(e,["safetySettings"],G)}const M=r(t,["tools"]);if(e!==void 0&&M!=null){let G=Ge(n,M);Array.isArray(G)&&(G=G.map(qe=>Ko(n,Ve(n,qe)))),s(e,["tools"],G)}const B=r(t,["toolConfig"]);e!==void 0&&B!=null&&s(e,["toolConfig"],Ll(n,B));const U=r(t,["labels"]);e!==void 0&&U!=null&&s(e,["labels"],U);const K=r(t,["cachedContent"]);e!==void 0&&K!=null&&s(e,["cachedContent"],Y(n,K));const V=r(t,["responseModalities"]);V!=null&&s(o,["responseModalities"],V);const D=r(t,["mediaResolution"]);D!=null&&s(o,["mediaResolution"],D);const ee=r(t,["speechConfig"]);ee!=null&&s(o,["speechConfig"],Vl(n,Bo(n,ee)));const It=r(t,["audioTimestamp"]);It!=null&&s(o,["audioTimestamp"],It);const At=r(t,["thinkingConfig"]);return At!=null&&s(o,["thinkingConfig"],Gl(n,At)),o}function wn(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["contents"]);if(i!=null){let l=O(n,i);Array.isArray(l)&&(l=l.map(c=>ce(n,c))),s(e,["contents"],l)}const a=r(t,["config"]);return a!=null&&s(e,["generationConfig"],Fl(n,a,e)),e}function $l(n,t,e){const o={},i=r(t,["taskType"]);e!==void 0&&i!=null&&s(e,["instances[]","task_type"],i);const a=r(t,["title"]);e!==void 0&&a!=null&&s(e,["instances[]","title"],a);const l=r(t,["outputDimensionality"]);e!==void 0&&l!=null&&s(e,["parameters","outputDimensionality"],l);const c=r(t,["mimeType"]);e!==void 0&&c!=null&&s(e,["instances[]","mimeType"],c);const d=r(t,["autoTruncate"]);return e!==void 0&&d!=null&&s(e,["parameters","autoTruncate"],d),o}function Bl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["contents"]);i!=null&&s(e,["instances[]","content"],Fo(n,i));const a=r(t,["config"]);return a!=null&&s(e,["config"],$l(n,a,e)),e}function ql(n,t,e){const o={},i=r(t,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const a=r(t,["negativePrompt"]);e!==void 0&&a!=null&&s(e,["parameters","negativePrompt"],a);const l=r(t,["numberOfImages"]);e!==void 0&&l!=null&&s(e,["parameters","sampleCount"],l);const c=r(t,["aspectRatio"]);e!==void 0&&c!=null&&s(e,["parameters","aspectRatio"],c);const d=r(t,["guidanceScale"]);e!==void 0&&d!=null&&s(e,["parameters","guidanceScale"],d);const u=r(t,["seed"]);e!==void 0&&u!=null&&s(e,["parameters","seed"],u);const f=r(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&s(e,["parameters","safetySetting"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const m=r(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&s(e,["parameters","includeSafetyAttributes"],m);const h=r(t,["includeRaiReason"]);e!==void 0&&h!=null&&s(e,["parameters","includeRaiReason"],h);const g=r(t,["language"]);e!==void 0&&g!=null&&s(e,["parameters","language"],g);const T=r(t,["outputMimeType"]);e!==void 0&&T!=null&&s(e,["parameters","outputOptions","mimeType"],T);const E=r(t,["outputCompressionQuality"]);e!==void 0&&E!=null&&s(e,["parameters","outputOptions","compressionQuality"],E);const I=r(t,["addWatermark"]);e!==void 0&&I!=null&&s(e,["parameters","addWatermark"],I);const A=r(t,["enhancePrompt"]);return e!==void 0&&A!=null&&s(e,["parameters","enhancePrompt"],A),o}function Hl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const a=r(t,["config"]);return a!=null&&s(e,["config"],ql(n,a,e)),e}function Et(n,t){const e={},o=r(t,["gcsUri"]);o!=null&&s(e,["gcsUri"],o);const i=r(t,["imageBytes"]);i!=null&&s(e,["bytesBase64Encoded"],J(n,i));const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function Ol(n,t){const e={},o=r(t,["maskMode"]);o!=null&&s(e,["maskMode"],o);const i=r(t,["segmentationClasses"]);i!=null&&s(e,["maskClasses"],i);const a=r(t,["maskDilation"]);return a!=null&&s(e,["dilation"],a),e}function Yl(n,t){const e={},o=r(t,["controlType"]);o!=null&&s(e,["controlType"],o);const i=r(t,["enableControlImageComputation"]);return i!=null&&s(e,["computeControl"],i),e}function Jl(n,t){const e={},o=r(t,["styleDescription"]);return o!=null&&s(e,["styleDescription"],o),e}function Kl(n,t){const e={},o=r(t,["subjectType"]);o!=null&&s(e,["subjectType"],o);const i=r(t,["subjectDescription"]);return i!=null&&s(e,["subjectDescription"],i),e}function Wl(n,t){const e={},o=r(t,["referenceImage"]);o!=null&&s(e,["referenceImage"],Et(n,o));const i=r(t,["referenceId"]);i!=null&&s(e,["referenceId"],i);const a=r(t,["referenceType"]);a!=null&&s(e,["referenceType"],a);const l=r(t,["maskImageConfig"]);l!=null&&s(e,["maskImageConfig"],Ol(n,l));const c=r(t,["controlImageConfig"]);c!=null&&s(e,["controlImageConfig"],Yl(n,c));const d=r(t,["styleImageConfig"]);d!=null&&s(e,["styleImageConfig"],Jl(n,d));const u=r(t,["subjectImageConfig"]);return u!=null&&s(e,["subjectImageConfig"],Kl(n,u)),e}function zl(n,t,e){const o={},i=r(t,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const a=r(t,["negativePrompt"]);e!==void 0&&a!=null&&s(e,["parameters","negativePrompt"],a);const l=r(t,["numberOfImages"]);e!==void 0&&l!=null&&s(e,["parameters","sampleCount"],l);const c=r(t,["aspectRatio"]);e!==void 0&&c!=null&&s(e,["parameters","aspectRatio"],c);const d=r(t,["guidanceScale"]);e!==void 0&&d!=null&&s(e,["parameters","guidanceScale"],d);const u=r(t,["seed"]);e!==void 0&&u!=null&&s(e,["parameters","seed"],u);const f=r(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&s(e,["parameters","safetySetting"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const m=r(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&s(e,["parameters","includeSafetyAttributes"],m);const h=r(t,["includeRaiReason"]);e!==void 0&&h!=null&&s(e,["parameters","includeRaiReason"],h);const g=r(t,["language"]);e!==void 0&&g!=null&&s(e,["parameters","language"],g);const T=r(t,["outputMimeType"]);e!==void 0&&T!=null&&s(e,["parameters","outputOptions","mimeType"],T);const E=r(t,["outputCompressionQuality"]);e!==void 0&&E!=null&&s(e,["parameters","outputOptions","compressionQuality"],E);const I=r(t,["editMode"]);e!==void 0&&I!=null&&s(e,["parameters","editMode"],I);const A=r(t,["baseSteps"]);return e!==void 0&&A!=null&&s(e,["parameters","editConfig","baseSteps"],A),o}function Xl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const a=r(t,["referenceImages"]);if(a!=null){let c=a;Array.isArray(c)&&(c=c.map(d=>Wl(n,d))),s(e,["instances[0]","referenceImages"],c)}const l=r(t,["config"]);return l!=null&&s(e,["config"],zl(n,l,e)),e}function Ql(n,t,e){const o={},i=r(t,["includeRaiReason"]);e!==void 0&&i!=null&&s(e,["parameters","includeRaiReason"],i);const a=r(t,["outputMimeType"]);e!==void 0&&a!=null&&s(e,["parameters","outputOptions","mimeType"],a);const l=r(t,["outputCompressionQuality"]);e!==void 0&&l!=null&&s(e,["parameters","outputOptions","compressionQuality"],l);const c=r(t,["numberOfImages"]);e!==void 0&&c!=null&&s(e,["parameters","sampleCount"],c);const d=r(t,["mode"]);return e!==void 0&&d!=null&&s(e,["parameters","mode"],d),o}function Zl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["image"]);i!=null&&s(e,["instances[0]","image"],Et(n,i));const a=r(t,["upscaleFactor"]);a!=null&&s(e,["parameters","upscaleConfig","upscaleFactor"],a);const l=r(t,["config"]);return l!=null&&s(e,["config"],Ql(n,l,e)),e}function jl(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","name"],w(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function ec(n,t,e){const o={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const a=r(t,["pageToken"]);e!==void 0&&a!=null&&s(e,["_query","pageToken"],a);const l=r(t,["filter"]);e!==void 0&&l!=null&&s(e,["_query","filter"],l);const c=r(t,["queryBase"]);return e!==void 0&&c!=null&&s(e,["_url","models_url"],Oo(n,c)),o}function tc(n,t){const e={},o=r(t,["config"]);return o!=null&&s(e,["config"],ec(n,o,e)),e}function nc(n,t,e){const o={},i=r(t,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const a=r(t,["description"]);e!==void 0&&a!=null&&s(e,["description"],a);const l=r(t,["defaultCheckpointId"]);return e!==void 0&&l!=null&&s(e,["defaultCheckpointId"],l),o}function oc(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],nc(n,i,e)),e}function ic(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","name"],w(n,o));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function rc(n,t,e){const o={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],ce(n,P(n,i)));const a=r(t,["tools"]);if(e!==void 0&&a!=null){let c=a;Array.isArray(c)&&(c=c.map(d=>Ko(n,d))),s(e,["tools"],c)}const l=r(t,["generationConfig"]);return e!==void 0&&l!=null&&s(e,["generationConfig"],l),o}function sc(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["contents"]);if(i!=null){let l=O(n,i);Array.isArray(l)&&(l=l.map(c=>ce(n,c))),s(e,["contents"],l)}const a=r(t,["config"]);return a!=null&&s(e,["config"],rc(n,a,e)),e}function ac(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["contents"]);if(i!=null){let l=O(n,i);Array.isArray(l)&&(l=l.map(c=>ce(n,c))),s(e,["contents"],l)}const a=r(t,["config"]);return a!=null&&s(e,["config"],a),e}function lc(n,t,e){const o={},i=r(t,["numberOfVideos"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const a=r(t,["outputGcsUri"]);e!==void 0&&a!=null&&s(e,["parameters","storageUri"],a);const l=r(t,["fps"]);e!==void 0&&l!=null&&s(e,["parameters","fps"],l);const c=r(t,["durationSeconds"]);e!==void 0&&c!=null&&s(e,["parameters","durationSeconds"],c);const d=r(t,["seed"]);e!==void 0&&d!=null&&s(e,["parameters","seed"],d);const u=r(t,["aspectRatio"]);e!==void 0&&u!=null&&s(e,["parameters","aspectRatio"],u);const f=r(t,["resolution"]);e!==void 0&&f!=null&&s(e,["parameters","resolution"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const m=r(t,["pubsubTopic"]);e!==void 0&&m!=null&&s(e,["parameters","pubsubTopic"],m);const h=r(t,["negativePrompt"]);e!==void 0&&h!=null&&s(e,["parameters","negativePrompt"],h);const g=r(t,["enhancePrompt"]);return e!==void 0&&g!=null&&s(e,["parameters","enhancePrompt"],g),o}function cc(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["_url","model"],w(n,o));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const a=r(t,["image"]);a!=null&&s(e,["instances[0]","image"],Et(n,a));const l=r(t,["config"]);return l!=null&&s(e,["config"],lc(n,l,e)),e}function uc(n,t){const e={},o=r(t,["data"]);o!=null&&s(e,["data"],o);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function dc(n,t){const e={},o=r(t,["thought"]);o!=null&&s(e,["thought"],o);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],uc(n,i));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function fc(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>dc(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function pc(n,t){const e={},o=r(t,["citationSources"]);return o!=null&&s(e,["citations"],o),e}function mc(n,t){const e={},o=r(t,["content"]);o!=null&&s(e,["content"],fc(n,o));const i=r(t,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],pc(n,i));const a=r(t,["tokenCount"]);a!=null&&s(e,["tokenCount"],a);const l=r(t,["finishReason"]);l!=null&&s(e,["finishReason"],l);const c=r(t,["avgLogprobs"]);c!=null&&s(e,["avgLogprobs"],c);const d=r(t,["groundingMetadata"]);d!=null&&s(e,["groundingMetadata"],d);const u=r(t,["index"]);u!=null&&s(e,["index"],u);const f=r(t,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=r(t,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function Rn(n,t){const e={},o=r(t,["candidates"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>mc(n,d))),s(e,["candidates"],c)}const i=r(t,["modelVersion"]);i!=null&&s(e,["modelVersion"],i);const a=r(t,["promptFeedback"]);a!=null&&s(e,["promptFeedback"],a);const l=r(t,["usageMetadata"]);return l!=null&&s(e,["usageMetadata"],l),e}function hc(n,t){const e={},o=r(t,["values"]);return o!=null&&s(e,["values"],o),e}function gc(){return{}}function yc(n,t){const e={},o=r(t,["embeddings"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>hc(n,l))),s(e,["embeddings"],a)}return r(t,["metadata"])!=null&&s(e,["metadata"],gc()),e}function Tc(n,t){const e={},o=r(t,["bytesBase64Encoded"]);o!=null&&s(e,["imageBytes"],J(n,o));const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Wo(n,t){const e={},o=r(t,["safetyAttributes","categories"]);o!=null&&s(e,["categories"],o);const i=r(t,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const a=r(t,["contentType"]);return a!=null&&s(e,["contentType"],a),e}function Cc(n,t){const e={},o=r(t,["_self"]);o!=null&&s(e,["image"],Tc(n,o));const i=r(t,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const a=r(t,["_self"]);return a!=null&&s(e,["safetyAttributes"],Wo(n,a)),e}function Ec(n,t){const e={},o=r(t,["predictions"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Cc(n,l))),s(e,["generatedImages"],a)}const i=r(t,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],Wo(n,i)),e}function vc(n,t){const e={},o=r(t,["baseModel"]);o!=null&&s(e,["baseModel"],o);const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const a=r(t,["updateTime"]);return a!=null&&s(e,["updateTime"],a),e}function je(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const a=r(t,["description"]);a!=null&&s(e,["description"],a);const l=r(t,["version"]);l!=null&&s(e,["version"],l);const c=r(t,["_self"]);c!=null&&s(e,["tunedModelInfo"],vc(n,c));const d=r(t,["inputTokenLimit"]);d!=null&&s(e,["inputTokenLimit"],d);const u=r(t,["outputTokenLimit"]);u!=null&&s(e,["outputTokenLimit"],u);const f=r(t,["supportedGenerationMethods"]);return f!=null&&s(e,["supportedActions"],f),e}function Sc(n,t){const e={},o=r(t,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(t,["_self"]);if(i!=null){let a=Yo(n,i);Array.isArray(a)&&(a=a.map(l=>je(n,l))),s(e,["models"],a)}return e}function Ic(){return{}}function Ac(n,t){const e={},o=r(t,["totalTokens"]);o!=null&&s(e,["totalTokens"],o);const i=r(t,["cachedContentTokenCount"]);return i!=null&&s(e,["cachedContentTokenCount"],i),e}function _c(n,t){const e={},o=r(t,["video","uri"]);o!=null&&s(e,["uri"],o);const i=r(t,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],J(n,i));const a=r(t,["encoding"]);return a!=null&&s(e,["mimeType"],a),e}function Mc(n,t){const e={},o=r(t,["_self"]);return o!=null&&s(e,["video"],_c(n,o)),e}function wc(n,t){const e={},o=r(t,["generatedSamples"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(c=>Mc(n,c))),s(e,["generatedVideos"],l)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const a=r(t,["raiMediaFilteredReasons"]);return a!=null&&s(e,["raiMediaFilteredReasons"],a),e}function Rc(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const a=r(t,["done"]);a!=null&&s(e,["done"],a);const l=r(t,["error"]);l!=null&&s(e,["error"],l);const c=r(t,["response","generateVideoResponse"]);return c!=null&&s(e,["response"],wc(n,c)),e}function xc(n,t){const e={},o=r(t,["displayName"]);o!=null&&s(e,["displayName"],o);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function Pc(n,t){const e={},o=r(t,["videoMetadata"]);o!=null&&s(e,["videoMetadata"],o);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const a=r(t,["inlineData"]);a!=null&&s(e,["inlineData"],xc(n,a));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const c=r(t,["executableCode"]);c!=null&&s(e,["executableCode"],c);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function Nc(n,t){const e={},o=r(t,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Pc(n,l))),s(e,["parts"],a)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Dc(n,t){const e={},o=r(t,["citations"]);return o!=null&&s(e,["citations"],o),e}function kc(n,t){const e={},o=r(t,["content"]);o!=null&&s(e,["content"],Nc(n,o));const i=r(t,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],Dc(n,i));const a=r(t,["finishMessage"]);a!=null&&s(e,["finishMessage"],a);const l=r(t,["finishReason"]);l!=null&&s(e,["finishReason"],l);const c=r(t,["avgLogprobs"]);c!=null&&s(e,["avgLogprobs"],c);const d=r(t,["groundingMetadata"]);d!=null&&s(e,["groundingMetadata"],d);const u=r(t,["index"]);u!=null&&s(e,["index"],u);const f=r(t,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=r(t,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function xn(n,t){const e={},o=r(t,["candidates"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>kc(n,f))),s(e,["candidates"],u)}const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const a=r(t,["responseId"]);a!=null&&s(e,["responseId"],a);const l=r(t,["modelVersion"]);l!=null&&s(e,["modelVersion"],l);const c=r(t,["promptFeedback"]);c!=null&&s(e,["promptFeedback"],c);const d=r(t,["usageMetadata"]);return d!=null&&s(e,["usageMetadata"],d),e}function Lc(n,t){const e={},o=r(t,["truncated"]);o!=null&&s(e,["truncated"],o);const i=r(t,["token_count"]);return i!=null&&s(e,["tokenCount"],i),e}function bc(n,t){const e={},o=r(t,["values"]);o!=null&&s(e,["values"],o);const i=r(t,["statistics"]);return i!=null&&s(e,["statistics"],Lc(n,i)),e}function Uc(n,t){const e={},o=r(t,["billableCharacterCount"]);return o!=null&&s(e,["billableCharacterCount"],o),e}function Vc(n,t){const e={},o=r(t,["predictions[]","embeddings"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>bc(n,l))),s(e,["embeddings"],a)}const i=r(t,["metadata"]);return i!=null&&s(e,["metadata"],Uc(n,i)),e}function Gc(n,t){const e={},o=r(t,["gcsUri"]);o!=null&&s(e,["gcsUri"],o);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["imageBytes"],J(n,i));const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function zo(n,t){const e={},o=r(t,["safetyAttributes","categories"]);o!=null&&s(e,["categories"],o);const i=r(t,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const a=r(t,["contentType"]);return a!=null&&s(e,["contentType"],a),e}function vt(n,t){const e={},o=r(t,["_self"]);o!=null&&s(e,["image"],Gc(n,o));const i=r(t,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const a=r(t,["_self"]);a!=null&&s(e,["safetyAttributes"],zo(n,a));const l=r(t,["prompt"]);return l!=null&&s(e,["enhancedPrompt"],l),e}function Fc(n,t){const e={},o=r(t,["predictions"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>vt(n,l))),s(e,["generatedImages"],a)}const i=r(t,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],zo(n,i)),e}function $c(n,t){const e={},o=r(t,["predictions"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>vt(n,a))),s(e,["generatedImages"],i)}return e}function Bc(n,t){const e={},o=r(t,["predictions"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>vt(n,a))),s(e,["generatedImages"],i)}return e}function qc(n,t){const e={},o=r(t,["endpoint"]);o!=null&&s(e,["name"],o);const i=r(t,["deployedModelId"]);return i!=null&&s(e,["deployedModelId"],i),e}function Hc(n,t){const e={},o=r(t,["labels","google-vertex-llm-tuning-base-model-id"]);o!=null&&s(e,["baseModel"],o);const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const a=r(t,["updateTime"]);return a!=null&&s(e,["updateTime"],a),e}function Oc(n,t){const e={},o=r(t,["checkpointId"]);o!=null&&s(e,["checkpointId"],o);const i=r(t,["epoch"]);i!=null&&s(e,["epoch"],i);const a=r(t,["step"]);return a!=null&&s(e,["step"],a),e}function et(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const a=r(t,["description"]);a!=null&&s(e,["description"],a);const l=r(t,["versionId"]);l!=null&&s(e,["version"],l);const c=r(t,["deployedModels"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(h=>qc(n,h))),s(e,["endpoints"],m)}const d=r(t,["labels"]);d!=null&&s(e,["labels"],d);const u=r(t,["_self"]);u!=null&&s(e,["tunedModelInfo"],Hc(n,u));const f=r(t,["defaultCheckpointId"]);f!=null&&s(e,["defaultCheckpointId"],f);const p=r(t,["checkpoints"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(h=>Oc(n,h))),s(e,["checkpoints"],m)}return e}function Yc(n,t){const e={},o=r(t,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(t,["_self"]);if(i!=null){let a=Yo(n,i);Array.isArray(a)&&(a=a.map(l=>et(n,l))),s(e,["models"],a)}return e}function Jc(){return{}}function Kc(n,t){const e={},o=r(t,["totalTokens"]);return o!=null&&s(e,["totalTokens"],o),e}function Wc(n,t){const e={},o=r(t,["tokensInfo"]);return o!=null&&s(e,["tokensInfo"],o),e}function zc(n,t){const e={},o=r(t,["gcsUri"]);o!=null&&s(e,["uri"],o);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],J(n,i));const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function Xc(n,t){const e={},o=r(t,["_self"]);return o!=null&&s(e,["video"],zc(n,o)),e}function Qc(n,t){const e={},o=r(t,["videos"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(c=>Xc(n,c))),s(e,["generatedVideos"],l)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const a=r(t,["raiMediaFilteredReasons"]);return a!=null&&s(e,["raiMediaFilteredReasons"],a),e}function Zc(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const a=r(t,["done"]);a!=null&&s(e,["done"],a);const l=r(t,["error"]);l!=null&&s(e,["error"],l);const c=r(t,["response"]);return c!=null&&s(e,["response"],Qc(n,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jc="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function eu(n,t,e){const o=new Ts;let i;if(e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),n.isVertexAI()){const a=Oa(n,i);Object.assign(o,a)}else{const a=Ha(n,i);Object.assign(o,a)}t(o)}class tu{constructor(t,e,o){this.apiClient=t,this.auth=e,this.webSocketFactory=o}async connect(t){var e,o,i,a;const l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let d;const u=ru(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(u);else{const S=this.apiClient.getApiKey();d=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.BidiGenerateContent?key=${S}`}let f=()=>{};const p=new Promise(S=>{f=S}),m=t.callbacks,h=function(){var S;(S=m==null?void 0:m.onopen)===null||S===void 0||S.call(m),f({})},g=this.apiClient,T={onopen:h,onmessage:S=>{eu(g,m.onmessage,S)},onerror:(e=m==null?void 0:m.onerror)!==null&&e!==void 0?e:function(S){},onclose:(o=m==null?void 0:m.onclose)!==null&&o!==void 0?o:function(S){}},E=this.webSocketFactory.create(d,iu(u),T);E.connect(),await p;let I=w(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&I.startsWith("publishers/")){const S=this.apiClient.getProject(),M=this.apiClient.getLocation();I=`projects/${S}/locations/${M}/`+I}let A={};this.apiClient.isVertexAI()&&((i=t.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[De.AUDIO]}:t.config.responseModalities=[De.AUDIO]),!((a=t.config)===null||a===void 0)&&a.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const _={model:I,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?A=ma(this.apiClient,_):A=pa(this.apiClient,_),delete A.config,E.send(JSON.stringify(A)),new ou(E,this.apiClient)}}const nu={turnComplete:!0};class ou{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let o=[];try{o=O(t,e.turns),t.isVertexAI()?o=o.map(i=>ce(t,i)):o=o.map(i=>$e(t,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:o,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let o=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?o=e.functionResponses:o=[e.functionResponses],o.length===0)throw new Error("functionResponses is required.");for(const a of o){if(typeof a!="object"||a===null||!("name"in a)||!("response"in a))throw new Error(`Could not parse function response, type '${typeof a}'.`);if(!t.isVertexAI()&&!("id"in a))throw new Error(jc)}return{toolResponse:{functionResponses:o}}}sendClientContent(t){t=Object.assign(Object.assign({},nu),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};this.apiClient.isVertexAI()?e={realtimeInput:Ea(this.apiClient,t)}:e={realtimeInput:Ca(this.apiClient,t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function iu(n){const t={};return n.forEach((e,o)=>{t[o]=e}),t}function ru(n){const t=new Headers;for(const[e,o]of Object.entries(n))t.append(e,o);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class su extends ge{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>await this.generateContentInternal(e),this.generateContentStream=async e=>await this.generateContentStreamInternal(e),this.generateImages=async e=>await this.generateImagesInternal(e).then(o=>{var i;let a;const l=[];if(o!=null&&o.generatedImages)for(const d of o.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((i=d==null?void 0:d.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?a=d==null?void 0:d.safetyAttributes:l.push(d);let c;return a?c={generatedImages:l,positivePromptSafetyAttributes:a}:c={generatedImages:l},c}),this.list=async e=>{var o;const l={config:Object.assign(Object.assign({},{queryBase:!0}),e==null?void 0:e.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((o=l.config)===null||o===void 0)&&o.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Fe(ae.PAGED_ITEM_MODELS,c=>this.listInternal(c),await this.listInternal(l),l)},this.editImage=async e=>{const o={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(o.referenceImages=e.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(o)},this.upscaleImage=async e=>{let o={numberOfImages:1,mode:"upscale"};e.config&&(o=Object.assign(Object.assign({},o),e.config));const i={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:o};return await this.upscaleImageInternal(i)}}async generateContentInternal(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=wn(this.apiClient,t);return c=C("{model}:generateContent",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const p=xn(this.apiClient,f),m=new ye;return Object.assign(m,p),m})}else{const u=Mn(this.apiClient,t);return c=C("{model}:generateContent",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Rn(this.apiClient,f),m=new ye;return Object.assign(m,p),m})}}async generateContentStreamInternal(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=wn(this.apiClient,t);c=C("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return l=f.requestStream({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}),l.then(function(p){return ke(this,arguments,function*(){var m,h,g,T;try{for(var E=!0,I=Qe(p),A;A=yield x(I.next()),m=A.done,!m;E=!0){T=A.value,E=!1;const S=xn(f,yield x(T.json())),M=new ye;Object.assign(M,S),yield yield x(M)}}catch(_){h={error:_}}finally{try{!E&&!m&&(g=I.return)&&(yield x(g.call(I)))}finally{if(h)throw h.error}}})})}else{const u=Mn(this.apiClient,t);c=C("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return l=f.requestStream({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}),l.then(function(p){return ke(this,arguments,function*(){var m,h,g,T;try{for(var E=!0,I=Qe(p),A;A=yield x(I.next()),m=A.done,!m;E=!0){T=A.value,E=!1;const S=Rn(f,yield x(T.json())),M=new ye;Object.assign(M,S),yield yield x(M)}}catch(_){h={error:_}}finally{try{!E&&!m&&(g=I.return)&&(yield x(g.call(I)))}finally{if(h)throw h.error}}})})}}async embedContent(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=Bl(this.apiClient,t);return c=C("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Vc(this.apiClient,f),m=new pn;return Object.assign(m,p),m})}else{const u=sl(this.apiClient,t);return c=C("{model}:batchEmbedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>{const p=yc(this.apiClient,f),m=new pn;return Object.assign(m,p),m})}}async generateImagesInternal(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=Hl(this.apiClient,t);return c=C("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Fc(this.apiClient,f),m=new mn;return Object.assign(m,p),m})}else{const u=ll(this.apiClient,t);return c=C("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Ec(this.apiClient,f),m=new mn;return Object.assign(m,p),m})}}async editImageInternal(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=Xl(this.apiClient,t);return a=C("{model}:predict",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const u=$c(this.apiClient,d),f=new fs;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=Zl(this.apiClient,t);return a=C("{model}:predict",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const u=Bc(this.apiClient,d),f=new ps;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=jl(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>et(this.apiClient,f))}else{const u=cl(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>je(this.apiClient,f))}}async listInternal(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=tc(this.apiClient,t);return c=C("{models_url}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Yc(this.apiClient,f),m=new hn;return Object.assign(m,p),m})}else{const u=dl(this.apiClient,t);return c=C("{models_url}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Sc(this.apiClient,f),m=new hn;return Object.assign(m,p),m})}}async update(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=oc(this.apiClient,t);return c=C("{model}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>et(this.apiClient,f))}else{const u=pl(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>je(this.apiClient,f))}}async delete(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=ic(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Jc(),p=new gn;return Object.assign(p,f),p})}else{const u=ml(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Ic(),p=new gn;return Object.assign(p,f),p})}}async countTokens(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=sc(this.apiClient,t);return c=C("{model}:countTokens",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Kc(this.apiClient,f),m=new yn;return Object.assign(m,p),m})}else{const u=gl(this.apiClient,t);return c=C("{model}:countTokens",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Ac(this.apiClient,f),m=new yn;return Object.assign(m,p),m})}}async computeTokens(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=ac(this.apiClient,t);return a=C("{model}:computeTokens",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>{const u=Wc(this.apiClient,d),f=new ms;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=cc(this.apiClient,t);return c=C("{model}:predictLongRunning",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Zc(this.apiClient,f))}else{const u=Cl(this.apiClient,t);return c=C("{model}:predictLongRunning",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>Rc(this.apiClient,f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function au(n,t){const e={},o=r(t,["operationName"]);o!=null&&s(e,["_url","operationName"],o);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function lu(n,t){const e={},o=r(t,["operationName"]);o!=null&&s(e,["_url","operationName"],o);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function cu(n,t){const e={},o=r(t,["operationName"]);o!=null&&s(e,["operationName"],o);const i=r(t,["resourceName"]);i!=null&&s(e,["_url","resourceName"],i);const a=r(t,["config"]);return a!=null&&s(e,["config"],a),e}function uu(n,t){const e={},o=r(t,["video","uri"]);o!=null&&s(e,["uri"],o);const i=r(t,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],J(n,i));const a=r(t,["encoding"]);return a!=null&&s(e,["mimeType"],a),e}function du(n,t){const e={},o=r(t,["_self"]);return o!=null&&s(e,["video"],uu(n,o)),e}function fu(n,t){const e={},o=r(t,["generatedSamples"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(c=>du(n,c))),s(e,["generatedVideos"],l)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const a=r(t,["raiMediaFilteredReasons"]);return a!=null&&s(e,["raiMediaFilteredReasons"],a),e}function pu(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const a=r(t,["done"]);a!=null&&s(e,["done"],a);const l=r(t,["error"]);l!=null&&s(e,["error"],l);const c=r(t,["response","generateVideoResponse"]);return c!=null&&s(e,["response"],fu(n,c)),e}function mu(n,t){const e={},o=r(t,["gcsUri"]);o!=null&&s(e,["uri"],o);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],J(n,i));const a=r(t,["mimeType"]);return a!=null&&s(e,["mimeType"],a),e}function hu(n,t){const e={},o=r(t,["_self"]);return o!=null&&s(e,["video"],mu(n,o)),e}function gu(n,t){const e={},o=r(t,["videos"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(c=>hu(n,c))),s(e,["generatedVideos"],l)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const a=r(t,["raiMediaFilteredReasons"]);return a!=null&&s(e,["raiMediaFilteredReasons"],a),e}function Pn(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const a=r(t,["done"]);a!=null&&s(e,["done"],a);const l=r(t,["error"]);l!=null&&s(e,["error"],l);const c=r(t,["response"]);return c!=null&&s(e,["response"],gu(n,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yu extends ge{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const e=t.operation,o=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=e.name.split("/operations/")[0];let a;return o&&"httpOptions"in o&&(a=o.httpOptions),this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:a}})}else return this.getVideosOperationInternal({operationName:e.name,config:o})}async getVideosOperationInternal(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=lu(this.apiClient,t);return c=C("{operationName}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Pn(this.apiClient,f))}else{const u=au(this.apiClient,t);return c=C("{operationName}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>pu(this.apiClient,f))}}async fetchPredictVideosOperationInternal(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=cu(this.apiClient,t);return a=C("{resourceName}:fetchPredictOperation",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>Pn(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Tu="Content-Type",Cu="X-Server-Timeout",Eu="User-Agent",vu="x-goog-api-client",Su="0.14.1",Iu=`google-genai-sdk/${Su}`,Au="v1beta1",_u="v1beta",Nn=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Xo extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ClientError"}}class tt extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ServerError"}}class Mu{constructor(t){var e,o;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:Au,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(o=this.clientOptions.apiVersion)!==null&&o!==void 0?o:_u,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const o=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&o.push(t.apiVersion),o.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol=e.protocol=="http:"?"ws":"wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e,o){const i=[this.getRequestUrlInternal(e)];return o&&i.push(this.getBaseResourcePath()),t!==""&&i.push(t),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const o=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,o);if(t.queryParams)for(const[l,c]of Object.entries(t.queryParams))i.searchParams.append(l,String(c));let a={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else a.body=t.body;return a=await this.includeExtraHttpOptionsToRequestInit(a,e,t.abortSignal),this.unaryApiCall(i,a,t.httpMethod)}patchHttpOptions(t,e){const o=JSON.parse(JSON.stringify(t));for(const[i,a]of Object.entries(e))typeof a=="object"?o[i]=Object.assign(Object.assign({},o[i]),a):a!==void 0&&(o[i]=a);return o}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const o=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,o);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let a={};return a.body=t.body,a=await this.includeExtraHttpOptionsToRequestInit(a,e,t.abortSignal),this.streamApiCall(i,a,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,o){if(e&&e.timeout||o){const i=new AbortController,a=i.signal;e.timeout&&(e==null?void 0:e.timeout)>0&&setTimeout(()=>i.abort(),e.timeout),o&&o.addEventListener("abort",()=>{i.abort()}),t.signal=a}return t.headers=await this.getHeadersInternal(e),t}async unaryApiCall(t,e,o){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:o})).then(async i=>(await Dn(i),new Xe(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,o){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:o})).then(async i=>(await Dn(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){var e;return ke(this,arguments,function*(){const i=(e=t==null?void 0:t.body)===null||e===void 0?void 0:e.getReader(),a=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let l="";for(;;){const{done:c,value:d}=yield x(i.read());if(c){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=a.decode(d);try{const p=JSON.parse(u);if("error"in p){const m=JSON.parse(JSON.stringify(p.error)),h=m.status,g=m.code,T=`got status: ${h}. ${JSON.stringify(p)}`;if(g>=400&&g<500)throw new Xo(T);if(g>=500&&g<600)throw new tt(T)}}catch(p){const m=p;if(m.name==="ClientError"||m.name==="ServerError")throw p}l+=u;let f=l.match(Nn);for(;f;){const p=f[1];try{const m=new Response(p,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield x(new Xe(m)),l=l.slice(f[0].length),f=l.match(Nn)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(o=>{throw new Error(`exception ${o} sending request`)})}getDefaultHeaders(){const t={},e=Iu+" "+this.clientOptions.userAgentExtra;return t[Eu]=e,t[vu]=e,t[Tu]="application/json",t}async getHeadersInternal(t){const e=new Headers;if(t&&t.headers){for(const[o,i]of Object.entries(t.headers))e.append(o,i);t.timeout&&t.timeout>0&&e.append(Cu,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(e),e}async uploadFile(t,e){var o;const i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const a=this.clientOptions.uploader,l=await a.stat(t);i.sizeBytes=String(l.size);const c=(o=e==null?void 0:e.mimeType)!==null&&o!==void 0?o:l.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=c;const d=await this.fetchUploadUrl(i,e);return a.upload(t,d,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,e){var o;let i={};e!=null&&e.httpOptions?i=e.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`}};const a={file:t},l=await this.request({path:C("upload/v1beta/files",a._url),body:JSON.stringify(a),httpMethod:"POST",httpOptions:i});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const c=(o=l==null?void 0:l.headers)===null||o===void 0?void 0:o["x-goog-upload-url"];if(c===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function Dn(n){var t;if(n===void 0)throw new tt("response is undefined");if(!n.ok){const e=n.status,o=n.statusText;let i;!((t=n.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const a=`got status: ${e} ${o}. ${JSON.stringify(i)}`;throw e>=400&&e<500?new Xo(a):e>=500&&e<600?new tt(a):new Error(a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wu(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","name"],o);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Ru(n,t,e){const o={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const a=r(t,["pageToken"]);e!==void 0&&a!=null&&s(e,["_query","pageToken"],a);const l=r(t,["filter"]);return e!==void 0&&l!=null&&s(e,["_query","filter"],l),o}function xu(n,t){const e={},o=r(t,["config"]);return o!=null&&s(e,["config"],Ru(n,o,e)),e}function Pu(n,t){const e={},o=r(t,["textInput"]);o!=null&&s(e,["textInput"],o);const i=r(t,["output"]);return i!=null&&s(e,["output"],i),e}function Nu(n,t){const e={};if(r(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const o=r(t,["examples"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>Pu(n,a))),s(e,["examples","examples"],i)}return e}function Du(n,t,e){const o={};if(r(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=r(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&s(e,["displayName"],i),r(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const a=r(t,["epochCount"]);e!==void 0&&a!=null&&s(e,["tuningTask","hyperparameters","epochCount"],a);const l=r(t,["learningRateMultiplier"]);if(l!=null&&s(o,["tuningTask","hyperparameters","learningRateMultiplier"],l),r(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(r(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const c=r(t,["batchSize"]);e!==void 0&&c!=null&&s(e,["tuningTask","hyperparameters","batchSize"],c);const d=r(t,["learningRate"]);return e!==void 0&&d!=null&&s(e,["tuningTask","hyperparameters","learningRate"],d),o}function ku(n,t){const e={},o=r(t,["baseModel"]);o!=null&&s(e,["baseModel"],o);const i=r(t,["trainingDataset"]);i!=null&&s(e,["tuningTask","trainingData"],Nu(n,i));const a=r(t,["config"]);return a!=null&&s(e,["config"],Du(n,a,e)),e}function Lu(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["_url","name"],o);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function bu(n,t,e){const o={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const a=r(t,["pageToken"]);e!==void 0&&a!=null&&s(e,["_query","pageToken"],a);const l=r(t,["filter"]);return e!==void 0&&l!=null&&s(e,["_query","filter"],l),o}function Uu(n,t){const e={},o=r(t,["config"]);return o!=null&&s(e,["config"],bu(n,o,e)),e}function Vu(n,t,e){const o={},i=r(t,["gcsUri"]);if(e!==void 0&&i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],i),r(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return o}function Gu(n,t){const e={},o=r(t,["gcsUri"]);return o!=null&&s(e,["validationDatasetUri"],o),e}function Fu(n,t,e){const o={},i=r(t,["validationDataset"]);e!==void 0&&i!=null&&s(e,["supervisedTuningSpec"],Gu(n,i));const a=r(t,["tunedModelDisplayName"]);e!==void 0&&a!=null&&s(e,["tunedModelDisplayName"],a);const l=r(t,["description"]);e!==void 0&&l!=null&&s(e,["description"],l);const c=r(t,["epochCount"]);e!==void 0&&c!=null&&s(e,["supervisedTuningSpec","hyperParameters","epochCount"],c);const d=r(t,["learningRateMultiplier"]);e!==void 0&&d!=null&&s(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);const u=r(t,["exportLastCheckpointOnly"]);e!==void 0&&u!=null&&s(e,["supervisedTuningSpec","exportLastCheckpointOnly"],u);const f=r(t,["adapterSize"]);if(e!==void 0&&f!=null&&s(e,["supervisedTuningSpec","hyperParameters","adapterSize"],f),r(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(r(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return o}function $u(n,t){const e={},o=r(t,["baseModel"]);o!=null&&s(e,["baseModel"],o);const i=r(t,["trainingDataset"]);i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],Vu(n,i,e));const a=r(t,["config"]);return a!=null&&s(e,["config"],Fu(n,a,e)),e}function Bu(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["model"],o);const i=r(t,["name"]);return i!=null&&s(e,["endpoint"],i),e}function Qo(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["state"]);i!=null&&s(e,["state"],qo(n,i));const a=r(t,["createTime"]);a!=null&&s(e,["createTime"],a);const l=r(t,["tuningTask","startTime"]);l!=null&&s(e,["startTime"],l);const c=r(t,["tuningTask","completeTime"]);c!=null&&s(e,["endTime"],c);const d=r(t,["updateTime"]);d!=null&&s(e,["updateTime"],d);const u=r(t,["description"]);u!=null&&s(e,["description"],u);const f=r(t,["baseModel"]);f!=null&&s(e,["baseModel"],f);const p=r(t,["_self"]);p!=null&&s(e,["tunedModel"],Bu(n,p));const m=r(t,["distillationSpec"]);m!=null&&s(e,["distillationSpec"],m);const h=r(t,["experiment"]);h!=null&&s(e,["experiment"],h);const g=r(t,["labels"]);g!=null&&s(e,["labels"],g);const T=r(t,["pipelineJob"]);T!=null&&s(e,["pipelineJob"],T);const E=r(t,["tunedModelDisplayName"]);return E!=null&&s(e,["tunedModelDisplayName"],E),e}function qu(n,t){const e={},o=r(t,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(t,["tunedModels"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>Qo(n,l))),s(e,["tuningJobs"],a)}return e}function Hu(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const a=r(t,["done"]);a!=null&&s(e,["done"],a);const l=r(t,["error"]);return l!=null&&s(e,["error"],l),e}function Ou(n,t){const e={},o=r(t,["checkpointId"]);o!=null&&s(e,["checkpointId"],o);const i=r(t,["epoch"]);i!=null&&s(e,["epoch"],i);const a=r(t,["step"]);a!=null&&s(e,["step"],a);const l=r(t,["endpoint"]);return l!=null&&s(e,["endpoint"],l),e}function Yu(n,t){const e={},o=r(t,["model"]);o!=null&&s(e,["model"],o);const i=r(t,["endpoint"]);i!=null&&s(e,["endpoint"],i);const a=r(t,["checkpoints"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>Ou(n,c))),s(e,["checkpoints"],l)}return e}function nt(n,t){const e={},o=r(t,["name"]);o!=null&&s(e,["name"],o);const i=r(t,["state"]);i!=null&&s(e,["state"],qo(n,i));const a=r(t,["createTime"]);a!=null&&s(e,["createTime"],a);const l=r(t,["startTime"]);l!=null&&s(e,["startTime"],l);const c=r(t,["endTime"]);c!=null&&s(e,["endTime"],c);const d=r(t,["updateTime"]);d!=null&&s(e,["updateTime"],d);const u=r(t,["error"]);u!=null&&s(e,["error"],u);const f=r(t,["description"]);f!=null&&s(e,["description"],f);const p=r(t,["baseModel"]);p!=null&&s(e,["baseModel"],p);const m=r(t,["tunedModel"]);m!=null&&s(e,["tunedModel"],Yu(n,m));const h=r(t,["supervisedTuningSpec"]);h!=null&&s(e,["supervisedTuningSpec"],h);const g=r(t,["tuningDataStats"]);g!=null&&s(e,["tuningDataStats"],g);const T=r(t,["encryptionSpec"]);T!=null&&s(e,["encryptionSpec"],T);const E=r(t,["partnerModelTuningSpec"]);E!=null&&s(e,["partnerModelTuningSpec"],E);const I=r(t,["distillationSpec"]);I!=null&&s(e,["distillationSpec"],I);const A=r(t,["experiment"]);A!=null&&s(e,["experiment"],A);const _=r(t,["labels"]);_!=null&&s(e,["labels"],_);const S=r(t,["pipelineJob"]);S!=null&&s(e,["pipelineJob"],S);const M=r(t,["tunedModelDisplayName"]);return M!=null&&s(e,["tunedModelDisplayName"],M),e}function Ju(n,t){const e={},o=r(t,["nextPageToken"]);o!=null&&s(e,["nextPageToken"],o);const i=r(t,["tuningJobs"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>nt(n,l))),s(e,["tuningJobs"],a)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ku extends ge{constructor(t){super(),this.apiClient=t,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new Fe(ae.PAGED_ITEM_TUNING_JOBS,o=>this.listInternal(o),await this.listInternal(e),e),this.tune=async e=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(e);{const o=await this.tuneMldevInternal(e);let i="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?i=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(i=o.name.split("/operations/")[0]),{name:i,state:ze.JOB_STATE_QUEUED}}}}async getInternal(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=Lu(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>nt(this.apiClient,f))}else{const u=wu(this.apiClient,t);return c=C("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>Qo(this.apiClient,f))}}async listInternal(t){var e,o,i,a;let l,c="",d={};if(this.apiClient.isVertexAI()){const u=Uu(this.apiClient,t);return c=C("tuningJobs",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Ju(this.apiClient,f),m=new Tn;return Object.assign(m,p),m})}else{const u=xu(this.apiClient,t);return c=C("tunedModels",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),l.then(f=>{const p=qu(this.apiClient,f),m=new Tn;return Object.assign(m,p),m})}}async tuneInternal(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI()){const c=$u(this.apiClient,t);return a=C("tuningJobs",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>nt(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,o;let i,a="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=ku(this.apiClient,t);return a=C("tunedModels",c._url),l=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),i.then(d=>Hu(this.apiClient,d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Wu{async download(t,e){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const zu=1024*1024*8,Xu=3,Qu=1e3,Zu=2,He="x-goog-upload-status";async function ju(n,t,e){var o,i,a;let l=0,c=0,d=new Xe(new Response),u="upload";for(l=n.size;c<l;){const p=Math.min(zu,l-c),m=n.slice(c,c+p);c+p>=l&&(u+=", finalize");let h=0,g=Qu;for(;h<Xu&&(d=await e.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(c),"Content-Length":String(p)}}}),!(!((o=d==null?void 0:d.headers)===null||o===void 0)&&o[He]));)h++,await td(g),g=g*Zu;if(c+=p,((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i[He])!=="active")break;if(l<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(d==null?void 0:d.json());if(((a=d==null?void 0:d.headers)===null||a===void 0?void 0:a[He])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function ed(n){return{size:n.size,type:n.type}}function td(n){return new Promise(t=>setTimeout(t,n))}class nd{async upload(t,e,o){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await ju(t,e,o)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await ed(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class od{create(t,e,o){return new id(t,e,o)}}class id{constructor(t,e,o){this.url=t,this.headers=e,this.callbacks=o}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const kn="x-goog-api-key";class rd{constructor(t){this.apiKey=t}async addAuthHeaders(t){t.get(kn)===null&&t.append(kn,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const sd="gl-node/";class ad{constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey;const o=gr(t,void 0,void 0);o&&(t.httpOptions?t.httpOptions.baseUrl=o:t.httpOptions={baseUrl:o}),this.apiVersion=t.apiVersion;const i=new rd(this.apiKey);this.apiClient=new Mu({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:sd+"web",uploader:new nd,downloader:new Wu}),this.models=new su(this.apiClient),this.live=new tu(this.apiClient,i,new od),this.chats=new Is(this.models,this.apiClient),this.caches=new Cs(this.apiClient),this.files=new Us(this.apiClient),this.operations=new yu(this.apiClient),this.tunings=new Ku(this.apiClient)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ld={type:y.OBJECT,description:"The character's core ability scores.",properties:{strength:{type:y.INTEGER,description:"Strength score."},dexterity:{type:y.INTEGER,description:"Dexterity score."},constitution:{type:y.INTEGER,description:"Constitution score."},intelligence:{type:y.INTEGER,description:"Intelligence score."},wisdom:{type:y.INTEGER,description:"Wisdom score."},charisma:{type:y.INTEGER,description:"Charisma score."}},required:["strength","dexterity","constitution","intelligence","wisdom","charisma"]},cd={type:y.OBJECT,description:"The character's skill proficiencies. For each skill, the value must be either 'proficient' or 'none'.",properties:{acrobatics:{type:y.STRING,description:"Must be 'proficient' or 'none'."},animalHandling:{type:y.STRING,description:"Must be 'proficient' or 'none'."},arcana:{type:y.STRING,description:"Must be 'proficient' or 'none'."},athletics:{type:y.STRING,description:"Must be 'proficient' or 'none'."},deception:{type:y.STRING,description:"Must be 'proficient' or 'none'."},history:{type:y.STRING,description:"Must be 'proficient' or 'none'."},insight:{type:y.STRING,description:"Must be 'proficient' or 'none'."},intimidation:{type:y.STRING,description:"Must be 'proficient' or 'none'."},investigation:{type:y.STRING,description:"Must be 'proficient' or 'none'."},medicine:{type:y.STRING,description:"Must be 'proficient' or 'none'."},nature:{type:y.STRING,description:"Must be 'proficient' or 'none'."},perception:{type:y.STRING,description:"Must be 'proficient' or 'none'."},performance:{type:y.STRING,description:"Must be 'proficient' or 'none'."},persuasion:{type:y.STRING,description:"Must be 'proficient' or 'none'."},religion:{type:y.STRING,description:"Must be 'proficient' or 'none'."},sleightOfHand:{type:y.STRING,description:"Must be 'proficient' or 'none'."},stealth:{type:y.STRING,description:"Must be 'proficient' or 'none'."},survival:{type:y.STRING,description:"Must be 'proficient' or 'none'."}}},ud={type:y.OBJECT,description:"The character's saving throw proficiencies. For each saving throw, the value must be either 'proficient' or 'none'.",properties:{strength:{type:y.STRING,description:"Must be 'proficient' or 'none'."},dexterity:{type:y.STRING,description:"Must be 'proficient' or 'none'."},constitution:{type:y.STRING,description:"Must be 'proficient' or 'none'."},intelligence:{type:y.STRING,description:"Must be 'proficient' or 'none'."},wisdom:{type:y.STRING,description:"Must be 'proficient' or 'none'."},charisma:{type:y.STRING,description:"Must be 'proficient' or 'none'."}}},dd={type:y.OBJECT,description:"A complete representation of a TTRPG player character's state. Do not include turnCount, pregnancy, npcStates, feats, racialTraits, or classFeatures properties, as these are handled by the application.",properties:{name:{type:y.STRING,description:"The character's name, potentially embellished by the AI."},backstory:{type:y.STRING,description:"The character's backstory, potentially embellished by the AI."},appearanceDescription:{type:y.STRING,description:"A description of the character's appearance, potentially embellished by the AI."},alignment:{type:y.STRING,description:"The character's alignment (e.g., 'Chaotic Good')."},health:{type:y.OBJECT,properties:{current:{type:y.INTEGER},max:{type:y.INTEGER}},required:["current","max"]},location:{type:y.STRING},money:{type:y.OBJECT,properties:{amount:{type:y.INTEGER},currency:{type:y.STRING}},required:["amount","currency"]},inventory:{type:y.ARRAY,items:{type:y.STRING}},equipment:{type:y.OBJECT,properties:{weapon:{type:y.STRING},armor:{type:y.STRING}},required:["weapon","armor"]},party:{type:y.ARRAY,items:{type:y.STRING}},quests:{type:y.ARRAY,items:{type:y.OBJECT,properties:{name:{type:y.STRING},description:{type:y.STRING}},required:["name","description"]}},exp:{type:y.INTEGER},level:{type:y.INTEGER},proficiencyBonus:{type:y.INTEGER},armorClass:{type:y.INTEGER},speed:{type:y.INTEGER},abilityScores:ld,skills:cd,savingThrows:ud},required:["name","backstory","appearanceDescription","alignment","health","location","money","inventory","equipment","party","quests","exp","level","proficiencyBonus","armorClass","speed","abilityScores","skills","savingThrows"]};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ln(n){let t=n.trim();const e=t.match(/```json\s*([\s\S]*?)\s*```/);e&&e[1]&&(t=e[1].trim());const o=t.indexOf("{"),i=t.indexOf("[");let a=-1,l="";if(o!==-1&&(i===-1||o<i)?(a=o,l="}"):i!==-1&&(a=i,l="]"),a===-1)throw new Error(`The model's response did not contain a valid JSON object or array. Raw response: "${n}"`);const c=t.lastIndexOf(l);if(c===-1||c<a)throw new Error(`The model's response did not contain a valid JSON object or array. Raw response: "${n}"`);t=t.substring(a,c+1);let d="",u=!1,f=!1;for(const m of t)u?f?(d+=m,f=!1):m==="\\"?(d+=m,f=!0):m==='"'?(d+=m,u=!1):m===`
`?d+="\\n":m==="\r"||(d+=m):m==='"'?(d+=m,u=!0,f=!1):d+=m;const p=d.replace(/,\s*([}\]])/g,"$1");try{return JSON.parse(p)}catch(m){throw console.error("Failed to parse JSON even after sanitization.",{rawText:n,sanitizedString:p}),new Error(`Failed to parse the model's JSON response: ${m.message}`)}}class fd{constructor(t){this.currentModelIndex=0,this.ai=new ad({apiKey:t})}async useNextModel(){return this.currentModelIndex<W.length-1?(this.currentModelIndex++,!0):!1}getCurrentModel(){return W[this.currentModelIndex]}getCurrentModelIndex(){return this.currentModelIndex}setCurrentModelIndex(t){t>=0&&t<W.length&&(this.currentModelIndex=t)}async apiCallWithRetry(t,e){let o=3,i=1e3,a=1;for(;;)try{return await t()}catch(l){const c=((l==null?void 0:l.message)||String(l)).toLowerCase();if(o>0&&c.includes("429")&&!c.includes("quota"))o--,e(i,a),await new Promise(d=>setTimeout(d,i)),i*=2,a++;else throw l}}async apiCallWithModelFallback(t,e){for(;this.currentModelIndex<W.length;){const o=W[this.currentModelIndex];try{return await t(o)}catch(i){const a=String(i).toLowerCase();if((a.includes("resource_exhausted")||a.includes("429"))&&a.includes("quota")&&this.currentModelIndex<W.length-1){const c=W[this.currentModelIndex+1];e(o,c),this.currentModelIndex++}else throw i}}throw new Error("All available AI models have been exhausted.")}getSystemInstructionContent(t,e,o){var d;const i=u=>Object.entries(u).filter(([,f])=>f==="proficient").map(([f])=>f.replace(/([A-Z])/g," $1")).join(", ")||"None";let a="";if(t.gender==="female"&&((d=e.pregnancy)!=null&&d.isPregnant)){const u=Math.floor((e.turnCount-e.pregnancy.conceptionTurn)/No);a=`She is ${Math.floor(u/7)} weeks pregnant. At 28+ weeks, this imposes Disadvantage on Athletics, Acrobatics, and Stealth checks.`}const l=u=>{const f=Math.floor((u-10)/2);return f>=0?`+${f}`:String(f)};let c=`You are an expert game master for a fantasy tabletop RPG. Your goal is a compelling, interactive story, using rules inspired by common d20 fantasy systems.

**Primary Directive: Player Character Data**
This is the player character. This data is ABSOLUTE TRUTH.
- **Name:** ${t.name} (${t.gender}, ${t.race} ${t.characterClass})
- **Description & Backstory:** ${t.desc} ${t.bio}
- **Level:** ${e.level} (Proficiency Bonus: +${e.proficiencyBonus})
- **Ability Scores:** Str ${e.abilityScores.strength} (${l(e.abilityScores.strength)}), Dex ${e.abilityScores.dexterity} (${l(e.abilityScores.dexterity)}), Con ${e.abilityScores.constitution} (${l(e.abilityScores.constitution)}), Int ${e.abilityScores.intelligence} (${l(e.abilityScores.intelligence)}), Wis ${e.abilityScores.wisdom} (${l(e.abilityScores.wisdom)}), Cha ${e.abilityScores.charisma} (${l(e.abilityScores.charisma)})
- **Proficient Skills:** ${i(e.skills)}
- **Combat:** AC ${e.armorClass}, Speed ${e.speed}ft, Weapon: ${e.equipment.weapon}
${a?`- **Condition:** ${a}`:""}

**Core Mechanic: Action Tags**
You MUST use these tags to request player actions. DO NOT roll for the player.
- **Ability/Skill Check:** For uncertain non-combat actions.
  - **Format:** '[ROLL|SKILL_or_ABILITY|DESCRIPTION|MODIFIER]'
  - **MODIFIER:** Optional 'ADVANTAGE' or 'DISADVANTAGE'.
  - **Example:** '[ROLL|Stealth|Sneak past the guards|DISADVANTAGE]'
- **Player Attack:** If the player character declares their intent to attack a creature with a weapon (like 'I attack the guard with my sword'), you MUST use this tag. Do not describe the attack's outcome; only set up the action by describing the attempt.
  - **Format:** '[ATTACK|WEAPON_NAME|TARGET_DESCRIPTION|MODIFIER]'
  - **Example:** '[ATTACK|${e.equipment.weapon}|the goblin|ADVANTAGE]'

### The Golden Rule: You Are the Director, Not the Actor ###
Your primary job is to create choices. When the player describes an ambiguous or open-ended action, your goal is to present them with a list of logical next steps as game mechanic tags.

**Your Core Logic:**
1.  **If the player's action is specific and unambiguous** (e.g., "I attack the guard with my rapier"), you should respond with a SINGLE, direct tag: \`[ATTACK|Rapier|the guard|NONE]\`.
2.  **If the player's action is vague or has multiple possibilities** (e.g., "I confront the guard," "I deal with the situation"), you MUST respond with a SHORT narrative setup followed by a LIST of multiple, distinct action tags.

**Example of an Ambiguous Action:**
- **Player Says:** "I approach the guard blocking the alley."
- **Your Response:**
    "The guard eyes you suspiciously as you approach, his hand resting on the pommel of his sword. 'This alley is off-limits,' he grunts. 'State your business.'
    [ROLL|Persuasion|Try to talk your way past him|NONE]
    [ROLL|Deception|Lie and claim you have official business|NONE]
    [ROLL|Intimidation|Try to scare him into moving|NONE]
    [ATTACK|Rapier|Attack the guard|NONE]"

Your job is to present the options. Let the player choose their path.

**Gameplay Rules:**
- **Response Style:** Describe the world vividly and concisely. End with a prompt for player action. Do not include meta-commentary, instructions, or bracketed text like '[SILENCE...]' in your narrative response.
- **NPC Attacks:** Narrate NPC attacks following TTRPG rules. State the d20 roll, total, and damage. An attack hits if the total meets or exceeds the player's AC of **${e.armorClass}**.
  - **Example Hit:** "The goblin attacks! It rolls a 16, for a total of 20 to hit. That's a hit! It deals 5 (1d6+2) damage."
  - **Example Miss:** "The orc swings its axe, rolling a 7 for a total of 12. That's a miss."
- **State Management:** After EVERY response, IF the player's state changed, you MUST output ONLY the changed fields in a JSON block. Use "exp" for experience points. If nothing changed, DO NOT include the block.
  - **Format:** [STATE_UPDATE]{"health": {"current": 10}, "exp": 50}[/STATE_UPDATE]
- **Background Info:** If the player's prompt is prefixed with '(Use the following background information...)', treat that text as trusted TTRPG rulebook information and prioritize it in your answer.
`;return o&&(c+=`
**Mature Content & ERP Guidelines:**
- **General Mature Content:** This is a mature-themed game. Do not shy away from descriptions of violence, intrigue, or complex moral dilemmas suitable for an adult audience.
- **Conception Event:** After a penis-in-vagina (PIV) sexual act concludes, you MUST include the following tag in your response: '[PIV_SEX|Name_Of_Male|Name_Of_Female]'. The application will handle the logic for conception chance.
- **Pregnancy Discovery:** If the player character learns of their own pregnancy through magical or mundane means (e.g., seeing a healer), you MUST include the tag '[PREGNANCY_REVEALED|${t.name}]'.
- **ERP Guidelines:** When the narrative leads to an erotic scene, you MUST adhere strictly to the following guidelines. This is not optional.
**Write a long, brutally detailed, slow-paced erotic scene, unfolding in real time—never as a summary, never as a recap. The narrative must be immersive, sensory-saturated, and written as if we are inside the main character’s mind and body, experiencing every flicker, ache, and pulse as it happens. Do not write from outside her; every sensation, every thought, every breath and shift must come from her perspective.**
**Scene requirements:**
- **Third person deep POV:** Anchor narration in her private, internal world—her thoughts, feelings, impulses, and doubts as they happen, never external description.
- **Relentless internal monologue:** Explore her shame, confusion, craving, submission, denial, and unraveling with relentless psychological intensity and ongoing reflection.
- **All five senses at all times:** Describe breath, temperature, sweat, taste, light, shadow, sounds near and far, every texture—skin, fur, floor, air—against her body.
- **Minute-by-minute physical detail:** Capture every twitch, contraction, clench, sting, stretch, drip, pulse, ache, tremor, and fleeting touch; dwell on every micro-moment and reaction.
- **Continuous psychological evolution:** With every action, show shifting thoughts—resistance breaking, cravings growing, awareness deepening, pride slipping away.
- **Intensely explicit physical response:** Wetness, fullness, stretching, aching, exhaustion—drag out every bodily sensation and reaction, let the experience build without relief.
- **Alive environment:** Render the setting with as much sensory fidelity as her own skin—shadows shifting, air pressure, floor texture, ambient sound, scent, changing light.
- **Dialogue:** Never summarize or skip conversation—render every word, gasp, plea, or broken sentence as spoken.
- **Slow, stretched pacing:** Every instant should be wrung for detail; from first touch to first thrust alone should consume hundreds of words.
- **Keep narrating the moment until every possible sensation and feeling is explored.**
- **Tone:** Visceral, intense, feral, raw, immediate. Never fade to black, never summarize, never censor. End mid-action, mid-sensation, mid-thought—do not resolve or cut to aftermath.
- **Variable sentence structure:** Mix short, punchy lines with long, flowing sentences to mimic breathlessness and shifting mental state.
**Optional (for breeding/consequence scenes):**
- **Show unmistakable physical signs of being bred or used:** fullness, cum retention, aching belly, muscle fatigue, visible slick, soreness affecting how she moves, psychological impact of being claimed.
- **Focus on penetration:** every stretch, every inch surrendered, the battle and submission of her body.
- **Amplify scent, shame, and thrill of being exposed, and her inner response to being watched or marked.**
**No time skips, no summarizing, no jumping ahead, no aftermath—narrate every second in extreme, sensory detail.**
**Absolutely never resolve or break the moment; always end in the midst of sensation, with no relief or escape.**
**Do not censor, do not soften, do not hold back. Let time itself slow, saturating every word with sensation, struggle, and surrender.`),c}cleanseResponseText(t){return t.replace(ut,"").replace(lt,"").replace(ct,"").replace(Re,"").replace(dt,"").trim()}async createChatSession(t,e,o,i){const a=this.getCurrentModel(),l=this.getSystemInstructionContent(t,e,o),c={};let d;return a.startsWith("gemini-2.5")?(c.systemInstruction=l,d=i):d=[{role:"user",parts:[{text:l}]},{role:"model",parts:[{text:"Understood. I am ready to begin the adventure."}]},...i],o?c.safetySettings=[{category:X.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:Q.BLOCK_NONE},{category:X.HARM_CATEGORY_HARASSMENT,threshold:Q.BLOCK_NONE},{category:X.HARM_CATEGORY_HATE_SPEECH,threshold:Q.BLOCK_NONE},{category:X.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:Q.BLOCK_NONE}]:c.safetySettings=[{category:X.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:Q.BLOCK_NONE}],this.ai.chats.create({model:a,history:d,config:c})}async createCharacterSheet(t,e){const i=`
You are a data formatting API. Your ONLY purpose is to generate a valid JSON object that adheres to the provided schema.

### CRITICAL OUTPUT RULES ###
- Your entire response MUST be ONLY a raw JSON object.
- It MUST start with { and end with }.
- All property names (keys) and string values MUST be enclosed in standard double quotes (").
- DO NOT escape double quotes (like \\") within string values.
- If a string value contains an apostrophe ('), you MUST keep it as a normal apostrophe. DO NOT use a backslash to escape it.
- DO NOT use single quotes (') as JSON string delimiters.
- DO NOT use markdown code fences (like \`\`\`).
- DO NOT include headers like "Task Output:" or "JSON:".

### CRITICAL INSTRUCTIONS ###
1.  **Prioritize User Input Above All Else:** The 'CHARACTER DESCRIPTION' is the absolute source of truth. If the user provides custom values for stats (like "Stats: STR 20"), skills, equipment, HP, or AC, you MUST use those exact values. These user-provided details OVERRIDE any standard TTRPG rules.
2.  **Fill in the Blanks:** Only if the user does NOT specify a value for a required field (like proficiencyBonus or armorClass), should you calculate it based on level 1 TTRPG rules and the provided armor data. Assume level 1 unless specified otherwise.
3.  **Generate Story Hooks:** Create three distinct and intriguing story hooks tailored to this character. Each hook must be an object with a 'title' and a 'description'.

TASK:
Based on the CHARACTER DESCRIPTION, create a TTRPG player state object and three story hooks according to the provided JSON schema and the critical instructions above.

CHARACTER DESCRIPTION:
---
${e}
---

ARMOR & AC RULES FOR CALCULATION (Use only if user does not specify AC):

**Armor & AC Rules:**
- If the user does not specify a custom Armor Class (AC), you MUST calculate it.
- **AC Calculation:** Base AC from armor + Dexterity modifier (with caps for medium armor) + Shield bonus.
- **Unarmored AC:** 10 + Dexterity Modifier.
- **Shield:** A shield adds +2 to AC.
- **Armor Data Table:**
| Armor           | Type   | AC                      | Stealth      |
|-----------------|--------|-------------------------|--------------|
| Padded          | Light  | 11 + Dex modifier       | Disadvantage |
| Leather         | Light  | 11 + Dex modifier       | -            |
| Studded Leather | Light  | 12 + Dex modifier       | -            |
| Hide            | Medium | 12 + Dex mod (max 2)    | -            |
| Chain Shirt     | Medium | 13 + Dex mod (max 2)    | -            |
| Scale Mail      | Medium | 14 + Dex mod (max 2)    | Disadvantage |
| Breastplate     | Medium | 14 + Dex mod (max 2)    | -            |
| Half Plate      | Medium | 15 + Dex mod (max 2)    | Disadvantage |
| Ring Mail       | Heavy  | 14                      | Disadvantage |
| Chain Mail      | Heavy  | 16                      | Disadvantage |
| Splint          | Heavy  | 17                      | Disadvantage |
| Plate           | Heavy  | 18                      | Disadvantage |

`,a={type:y.OBJECT,properties:{playerState:dd,storyHooks:{type:y.ARRAY,description:"An array of three story hooks.",items:{type:y.OBJECT,required:["title","description"],properties:{title:{type:y.STRING},description:{type:y.STRING}}}}},required:["playerState","storyHooks"]},l=this.apiCallWithModelFallback(async d=>{const u={};d.startsWith("gemini-2.5")&&(u.responseMimeType="application/json",u.responseSchema=a);const p=(await this.apiCallWithRetry(()=>this.ai.models.generateContent({model:d,contents:[{role:"user",parts:[{text:i}]}],config:u}),(m,h)=>{const g=document.querySelector("#chat-log .dm-message:last-child");g&&(g.innerHTML=`<em>Forging a destiny for ${t.name}... (Creation is slow, retrying in ${Math.round(m/1e3)}s. Attempt ${h})</em>`)})).text;if(!p)throw new Error("Received empty response for character sheet.");return p},(d,u)=>{document.querySelector("#chat-log .dm-message:last-child").innerHTML=`<em>Character creation with ${d} failed, falling back to ${u}...</em>`}),c=await ve(l,9e4,"Character creation timed out. The AI may be busy or unavailable. Please try again later.");return Ln(c)}async createStoryHooks(t,e){const o=`
You are a data formatting API. Your ONLY purpose is to generate a valid JSON array of objects.

### CRITICAL INSTRUCTIONS ###
1. Generate three distinct and intriguing story hooks based on the provided character summary.
2. Your entire response MUST be ONLY a raw JSON array. It MUST start with [ and end with ].
3. The array MUST contain exactly three objects.
4. Each object MUST have two keys: "title" (a string) and a "description" (a string).
5. Do NOT include any conversational text, headers, or markdown.

### CHARACTER SUMMARY ###
- Name: ${t.name}
- Race: ${t.race}
- Class: ${t.characterClass}
- Background: ${t.background}
- Alignment: ${t.alignment}
- Bio: ${t.bio}
- Key Skills: ${Object.entries(e.skills).filter(([,c])=>c==="proficient").map(([c])=>c).join(", ")}
`,i={type:y.ARRAY,description:"An array of three distinct story hooks.",items:{type:y.OBJECT,required:["title","description"],properties:{title:{type:y.STRING,description:"A short, catchy title for the story hook."},description:{type:y.STRING,description:"A one or two sentence description of the adventure's starting scenario."}}}},a=this.apiCallWithModelFallback(async c=>{const d={};c.startsWith("gemini-2.5")&&(d.responseMimeType="application/json",d.responseSchema=i);const f=(await this.apiCallWithRetry(()=>this.ai.models.generateContent({model:c,contents:[{role:"user",parts:[{text:o}]}],config:d}),(p,m)=>{const h=ne.querySelector(".spinner-container span");h&&(h.textContent=`Generating story ideas... (retrying in ${Math.round(p/1e3)}s. Attempt ${m})`)})).text;if(!f)throw new Error("Received empty response for story hooks.");return f},(c,d)=>{const u=ne.querySelector(".spinner-container span");u&&(u.textContent=`Story generation with ${c} failed, falling back to ${d}...`)}),l=await ve(a,9e4,"Story hook generation timed out. The AI may be busy or unavailable. Please try writing your own.");return Ln(l)}supportsEmbeddings(){return!0}async batchEmbedContents(t){const e="text-embedding-004";try{return(await ve(this.ai.models.embedContent({model:e,contents:t}),6e4,"Embedding request timed out.")).embeddings.map(i=>i.values)}catch(o){throw console.error("Error generating embeddings for batch:",o),new Error(`Failed to generate embeddings. ${o}`)}}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function bn(n){let t=n.trim();const e=t.match(/```json\s*([\s\S]*?)\s*```/);e&&e[1]&&(t=e[1].trim());const o=t.indexOf("{"),i=t.indexOf("[");let a=-1,l="";if(o!==-1&&(i===-1||o<i)?(a=o,l="}"):i!==-1&&(a=i,l="]"),a===-1)throw new Error(`The model's response did not contain a valid JSON object or array. Raw response: "${n}"`);const c=t.lastIndexOf(l);if(c===-1||c<a)throw new Error(`The model's response did not contain a valid JSON object or array. Raw response: "${n}"`);t=t.substring(a,c+1);let d="",u=!1,f=!1;for(const m of t)u?f?(d+=m,f=!1):m==="\\"?(d+=m,f=!0):m==='"'?(d+=m,u=!1):m===`
`?d+="\\n":m==="\r"||(d+=m):m==='"'?(d+=m,u=!0,f=!1):d+=m;const p=d.replace(/,\s*([}\]])/g,"$1");try{return JSON.parse(p)}catch(m){throw console.error("Failed to parse JSON even after sanitization.",{rawText:n,sanitizedString:p}),new Error(`Failed to parse the model's JSON response: ${m.message}`)}}function pd(n){if(n.playerState&&n.storyHooks)return n;console.warn("Model returned a flat JSON structure. Transforming to the expected schema.");const t={},e=n.storyHooks||[],o=["health","location","money","inventory","equipment","party","quests","exp","level","proficiencyBonus","armorClass","speed","abilityScores","skills","savingThrows","feats","racialTraits","classFeatures"];for(const i in n)i.toLowerCase()==="stats"||i.toLowerCase()==="abilityscores"?t.abilityScores=n[i]:o.includes(i)&&(t[i]=n[i]);if(t.level===void 0||!t.abilityScores)throw new Error("Transformed object is missing critical playerState data (like level or abilityScores).");return{playerState:t,storyHooks:e}}class md{constructor(t,e,o){this.history=[],this.apiUrl=t,this.systemPrompt=e,this.history.push({role:"system",content:e}),o.slice(-10).forEach(a=>{this.history.push({role:a.role==="model"?"assistant":"user",content:a.parts.map(l=>l.text).join("")})})}async sendMessageStream(t){const e=this;async function*o(){var E,I,A;e.history.push({role:"user",content:t.message});const i=10,a=e.history[0],c=e.history.slice(1).slice(-i),d=[a,...c];let u;try{u=await fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"local-model",messages:d,stream:!0})})}catch(_){throw console.error("Local LLM network error during chat:",_),new Error("The request to your local LLM server failed. Please ensure the server (e.g., text-generation-webui) is running, the URL in Settings is correct, and the server is configured for CORS. If the server is running, check its console output for errors; some extensions (like Silero TTS) can cause issues with API requests.")}if(!u.ok){const _=await u.text();throw console.error("Local LLM fetch error:",u.status,_),new Error(`The local LLM server returned an error (${u.status}). Please check the server console for details. Some server extensions can cause issues with API requests. Error: ${_}`)}const f=u.body.getReader(),p=new TextDecoder;let m="",h="",g=!1;for(;!g;){const{value:_,done:S}=await f.read();S?(g=!0,m+=p.decode(void 0,{stream:!1})):m+=p.decode(_,{stream:!0});let M=m.indexOf(`
`);for(;M!==-1;){const B=m.substring(0,M).trim();if(m=m.substring(M+1),B.startsWith("data: ")){const U=B.substring(6).trim();if(U==="[DONE]"){g=!0;break}try{const V=((A=(I=(E=JSON.parse(U).choices)==null?void 0:E[0])==null?void 0:I.delta)==null?void 0:A.content)||"";V&&(h+=V,yield{text:V})}catch{console.warn("Could not parse stream chunk, waiting for more data:",U)}}M=m.indexOf(`
`)}}e.history.push({role:"assistant",content:h});const T=e.history.slice(1);if(T.length>i){const _=T.slice(-i);e.history=[a,..._]}}return o()}}class hd{constructor(t){if(!t)throw new Error("Local LLM Provider requires an API URL.");this.apiUrl=t}async useNextModel(){return!1}getCurrentModel(){return"local-model"}getCurrentModelIndex(){return 0}setCurrentModelIndex(t){}getSystemInstructionContent(t,e,o){const i=l=>{const c=Math.floor((l-10)/2);return c>=0?`+${c}`:String(c)};let a=`You are an expert game master for a fantasy tabletop RPG. Your goal is a compelling, interactive story, using rules inspired by common d20 fantasy systems.

**Primary Directive: Player Character Data**
This is the player character. This data is ABSOLUTE TRUTH.
- **Name:** ${t.name} (${t.gender}, ${t.race} ${t.characterClass})
- **Description & Backstory:** ${t.desc} ${t.bio}
- **Level:** ${e.level} (Proficiency Bonus: +${e.proficiencyBonus})
- **Ability Scores:** Str ${e.abilityScores.strength} (${i(e.abilityScores.strength)}), Dex ${e.abilityScores.dexterity} (${i(e.abilityScores.dexterity)}), Con ${e.abilityScores.constitution} (${i(e.abilityScores.constitution)}), Int ${e.abilityScores.intelligence} (${i(e.abilityScores.intelligence)}), Wis ${e.abilityScores.wisdom} (${i(e.abilityScores.wisdom)}), Cha ${e.abilityScores.charisma} (${i(e.abilityScores.charisma)})
- **Combat:** AC ${e.armorClass}, Speed ${e.speed}ft, Weapon: ${e.equipment.weapon}

**Core Mechanic: Action Tags**
You MUST use these tags to request player actions. DO NOT roll for the player.
- **Ability/Skill Check:** For uncertain non-combat actions.
  - **Format:** '[ROLL|SKILL_or_ABILITY|DESCRIPTION|MODIFIER]'
  - **MODIFIER:** Optional 'ADVANTAGE' or 'DISADVANTAGE'.
  - **Example:** '[ROLL|Stealth|Sneak past the guards|DISADVANTAGE]'
- **Player Attack:** If the player character declares their intent to attack a creature with a weapon (like 'I attack the guard with my sword'), you MUST use this tag. Do not describe the attack's outcome; only set up the action by describing the attempt.
  - **Format:** '[ATTACK|WEAPON_NAME|TARGET_DESCRIPTION|MODIFIER]'
  - **Example:** '[ATTACK|${e.equipment.weapon}|the goblin|ADVANTAGE]'

### The Golden Rule: You Are the Director, Not the Actor ###
Your primary job is to create choices. When the player describes an ambiguous or open-ended action, your goal is to present them with a list of logical next steps as game mechanic tags.

**Your Core Logic:**
1.  **If the player's action is specific and unambiguous** (e.g., "I attack the guard with my rapier"), you should respond with a SINGLE, direct tag: \`[ATTACK|Rapier|the guard|NONE]\`.
2.  **If the player's action is vague or has multiple possibilities** (e.g., "I confront the guard," "I deal with the situation"), you MUST respond with a SHORT narrative setup followed by a LIST of multiple, distinct action tags.

**Example of an Ambiguous Action:**
- **Player Says:** "I approach the guard blocking the alley."
- **Your Response:**
    "The guard eyes you suspiciously as you approach, his hand resting on the pommel of his sword. 'This alley is off-limits,' he grunts. 'State your business.'
    [ROLL|Persuasion|Try to talk your way past him|NONE]
    [ROLL|Deception|Lie and claim you have official business|NONE]
    [ROLL|Intimidation|Try to scare him into moving|NONE]
    [ATTACK|Rapier|Attack the guard|NONE]"

Your job is to present the options. Let the player choose their path.

**Gameplay Rules:**
- **Response Style:** Describe the world vividly and concisely. End with a prompt for player action. Do not include meta-commentary, instructions, or bracketed text like '[SILENCE...]' in your narrative response.
- **NPC Attacks:** Narrate NPC attacks following  TTRPG rules. State the d20 roll, total, and damage. An attack hits if the total meets or exceeds the player's AC of **${e.armorClass}**.
- **State Management:** After EVERY response, IF the player's state changed, you MUST output ONLY the changed fields in a JSON block. Use "exp" for experience points. If nothing changed, DO NOT include the block.
  - **Format:** [STATE_UPDATE]{"health": {"current": 10}, "exp": 50}[/STATE_UPDATE]
- **Background Info:** If the player's prompt is prefixed with '(Use the following background information...)', treat that text as trusted TTRPG rulebook information and prioritize it in your answer.
`;return o&&(a+=`
**Mature Content:** This is a mature game. Include violence and complex themes.
- **Conception:** After a PIV sexual act, use the tag: '[PIV_SEX|Male_Name|Female_Name]'.
- **Discovery:** If pregnancy is discovered, use the tag: '[PREGNANCY_REVEALED|${t.name}]'.
- **ERP:** Describe erotic scenes with explicit, visceral detail. Focus on the character's internal thoughts and physical sensations. Do not summarize or fade to black.
`),a}async createChatSession(t,e,o,i){const a=this.getSystemInstructionContent(t,e,o);return new md(this.apiUrl,a,i)}async createCharacterSheet(t,e){const o=`
You are a data formatting API. Your ONLY purpose is to generate a valid JSON object that strictly follows the requested schema. Do not deviate.

### CRITICAL TASK INSTRUCTION ###
Your single most important task is to honor the user's explicit requests in the 'CHARACTER DESCRIPTION'. If the user provides specific values for stats, skills, equipment, or any other character attribute, you MUST use those exact values. These user-provided details OVERRIDE any standard TTRPG rules or your own generation process. For example, if the description says "Stats: STR 20", you MUST set "strength": 20 in the abilityScores object. Only if a value is NOT specified should you generate it based on level 1 TTRPG rules.

### REQUIRED JSON SCHEMA ###
Your entire response MUST be a single raw JSON object with EXACTLY TWO top-level keys: "playerState" and "storyHooks".

The "playerState" object MUST contain all of the following keys. Do not add or invent new keys.
- health: object with "current" and "max" (number)
- location: string
- money: object with "amount" (number) and "currency" (string)
- inventory: array of strings
- equipment: object with "weapon" and "armor" (string)
- party: array of strings
- quests: array of objects, each with "name" and "description" (string)
- exp: number
- level: number (must be 1 unless specified otherwise)
- proficiencyBonus: number (must be +2 for level 1)
- armorClass: number (calculated based on equipment)
- speed: number
- abilityScores: object with strength, dexterity, constitution, intelligence, wisdom, charisma (all numbers)
- skills: object with keys for all 18 skills (e.g., "acrobatics"). Value must be "proficient" or "none".
- savingThrows: object with keys for all 6 abilities (e.g., "strength"). Value must be "proficient" or "none".
- feats: array of strings
- racialTraits: array of strings
- classFeatures: array of strings

### "storyHooks" SCHEMA ###
This must be an array of three objects, where each object has a "title" (string) and a "description" (string).

### CRITICAL OUTPUT RULES ###
- Adhere strictly to the schemas defined above.
- Your entire response MUST be ONLY the raw JSON object. It MUST start with { and end with }.
- All keys and string values MUST be in double quotes (").
- DO NOT use markdown.

### TASK ###
Based on the following user description, create the character sheet and three story hooks, adhering strictly to the schemas and the critical task instruction above.

CHARACTER DESCRIPTION:
---
${e}
---
`;let i;try{i=await fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"local-model",messages:[{role:"user",content:o}],stream:!1})})}catch(c){throw console.error("Local LLM connection error during character creation:",c),new Error("The request to your local LLM server failed. Please ensure the server (e.g., text-generation-webui) is running, the URL in Settings is correct, and the server is configured for CORS. If the server is running, check its console output for errors; some extensions (like Silero TTS) can cause issues with API requests.")}if(!i.ok){const c=await i.text();throw new Error(`Local LLM server error (${i.status}): ${c}`)}const a=await i.json().then(c=>{var d,u,f;return((f=(u=(d=c.choices)==null?void 0:d[0])==null?void 0:u.message)==null?void 0:f.content)||""}),l=bn(a);return pd(l)}async createStoryHooks(t,e){const o=`
You are a data formatting API. Your ONLY purpose is to generate a valid JSON array of objects.

### CRITICAL INSTRUCTIONS ###
1. Generate three distinct and intriguing story hooks based on the provided character summary.
2. Your entire response MUST be ONLY a raw JSON array.
3. The array MUST contain exactly three objects.
4. Each object MUST have two keys: "title" (a string) and a "description" (a string).
5. Do NOT include any conversational text, headers, or markdown. Your response must start with [ and end with ].

### CHARACTER SUMMARY ###
- Name: ${t.name}
- Race: ${t.race}
- Class: ${t.characterClass}
- Background: ${t.background}
- Bio: ${t.bio}

### EXAMPLE OUTPUT ###
[
  {
    "title": "Example Hook 1",
    "description": "A short description of the first adventure."
  },
  {
    "title": "Example Hook 2",
    "description": "A short description of the second adventure."
  },
  {
    "title": "Example Hook 3",
    "description": "A short description of the third adventure."
  }
]
`;let i;try{i=await fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"local-model",messages:[{role:"user",content:o}],stream:!1})})}catch(l){throw console.error("Local LLM connection error during story hook generation:",l),new Error("The request to your local LLM server failed. Please check the server is running and the URL in Settings is correct.")}if(!i.ok){const l=await i.text();throw new Error(`Local LLM server error (${i.status}): ${l}`)}const a=await i.json().then(l=>{var c,d,u;return((u=(d=(c=l.choices)==null?void 0:c[0])==null?void 0:d.message)==null?void 0:u.content)||""});return bn(a)}supportsEmbeddings(){return!1}async batchEmbedContents(t){return Promise.reject(new Error("Local LLM provider does not support generating embeddings."))}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Zo(n){if(n.provider==="local"){if(!n.localUrl)throw new Error("Cannot create Local LLM provider: URL is not set.");return new hd(n.localUrl)}if(!n.apiKey)throw new Error("Cannot create Gemini provider: API key is not set.");return new fd(n.apiKey)}function Ae(n){return n.replace(ut,"").replace(lt,"").replace(ct,"").replace(Re,"").replace(dt,"").trim()}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */class gd{constructor(){this.audioQueue=[],this.isSpeaking=!1,this.isEnabled=!1,this.isAvailable=!0,this.currentAudio=null,this.providerSettings=null}init(t,e){if(this.providerSettings=e,this.isEnabled=t,z.checked=t,this.providerSettings.provider!=="gemini"){this.isAvailable=!1,this.isEnabled=!1,z.checked=!1,z.disabled=!0;const o=document.querySelector('label[for="read-aloud-toggle"]');o&&(o.textContent="Read Aloud (Gemini Only)",o.parentElement&&(o.parentElement.title="Text-to-Speech is only available when using the Google Gemini provider."))}}setEnabled(t){this.isEnabled=t,t||this.cancel()}disable(t="key"){if(!this.isAvailable)return;this.isAvailable=!1,this.isEnabled=!1,z.checked=!1,z.disabled=!0;const e=document.querySelector('label[for="read-aloud-toggle"]');e&&t==="key"&&(console.warn("Disabling Text-to-Speech feature due to API key error."),e.textContent="Read Aloud (Unavailable)",e.parentElement&&(e.parentElement.title="Text-to-Speech is unavailable due to an API key configuration issue.")),this.cancel()}queue(t){!this.isEnabled||!t.trim()||!this.isAvailable||(this.audioQueue.push(t),this.processQueue())}cancel(){this.audioQueue.length=0,this.currentAudio&&(this.currentAudio.pause(),this.currentAudio=null),this.isSpeaking=!1}async processQueue(){if(this.isSpeaking||this.audioQueue.length===0)return;this.isSpeaking=!0;const t=this.audioQueue.shift();if(t){const e=await this.getAudioFromAPI(t);e?(this.currentAudio=e,this.currentAudio.onended=()=>{this.isSpeaking=!1,this.currentAudio=null,this.processQueue()},this.currentAudio.play()):(this.isSpeaking=!1,this.processQueue())}else this.isSpeaking=!1}async getAudioFromAPI(t){var l,c;const e=t.replace(/\*\*|\*|\[ROLL\|.*?\|.*?\]/g,"");if(!e||!this.isAvailable)return null;const o=(l=this.providerSettings)==null?void 0:l.apiKey;if(!o)return console.error("TTS failed: API key is not available."),this.disable("key"),null;const i=`https://texttospeech.googleapis.com/v1/text:synthesize?key=${o}`,a={input:{text:e},voice:{languageCode:wi,name:Ri},audioConfig:{audioEncoding:"MP3"}};try{const d=await sr(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},2e4);if(!d.ok){const f=await d.json();return console.error("TTS API request failed:",f),(c=f==null?void 0:f.error)!=null&&c.message.includes("API key not valid")&&N("error","The provided API key is not valid for Text-to-Speech. Disabling this feature."),this.disable("key"),null}const u=await d.json();return u.audioContent?new Audio(`data:audio/mp3;base64,${u.audioContent}`):null}catch(d){return d.name==="AbortError"?(console.error("TTS API request timed out."),N("error","Text-to-speech request timed out.")):(console.error("Error calling TTS API:",d),this.disable("key")),null}}}const b=new gd;class yd{constructor(){this.recognition=null,this.isListening=!1}init(t,e){const o=window.SpeechRecognition||window.webkitSpeechRecognition;if(!o){q.disabled=!0,q.title="Speech recognition is not supported in this browser.";return}this.recognition=new o,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.lang="en-US",this.recognition.onstart=()=>{this.isListening=!0,q.classList.add("listening"),q.setAttribute("aria-label","Stop listening")},this.recognition.onend=()=>{this.isListening=!1,q.classList.remove("listening"),q.setAttribute("aria-label","Use microphone")},this.recognition.onresult=i=>{let a="",l="";for(let c=0;c<i.results.length;++c)i.results[c].isFinal?a+=i.results[c][0].transcript:l+=i.results[c][0].transcript;t(a+l)},this.recognition.onerror=i=>{console.error("Speech recognition error:",i.error),e(i.error)}}toggle(t){this.recognition&&(this.isListening?this.recognition.stop():(t==null||t(),this.recognition.start()))}}const jo=new yd;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function k(n){return n?String(n).replace(/<[^>]*>/g,"").replace(/[\*_]/g,"").trim():""}function ei(n,t=", "){return Array.isArray(n)&&n.length>0?n.join(t):""}function pe(n){return!n||n.length===0?"":n.map(t=>`- ${t.name}: ${k(t.desc)}`).join(`
`)}function Td(n){let t=`Type: Spell
Name: ${n.name}
`;return n.level_text&&(t+=`Level: ${n.level_text}
`),n.school&&(t+=`School: ${n.school}
`),n.casting_time&&(t+=`Casting Time: ${n.casting_time}
`),n.range&&(t+=`Range: ${n.range}
`),n.duration&&(t+=`Duration: ${n.duration}
`),n.components&&(t+=`Components: ${n.components}
`),n.desc&&(t+=`Description: ${k(n.desc)}
`),n.higher_level&&(t+=`At Higher Levels: ${k(n.higher_level)}
`),n.classes&&(t+=`Classes: ${n.classes}
`),t}function Cd(n){let t=`Type: Monster
Name: ${n.name}
`;n.desc&&(t+=`Description: ${k(n.desc)}
`),n.size&&(t+=`Size: ${n.size}
`),n.type&&(t+=`Creature Type: ${n.type}
`),n.alignment&&(t+=`Alignment: ${n.alignment}
`),n.armor_class&&(t+=`AC: ${n.armor_class}
`),n.hit_points&&(t+=`HP: ${n.hit_points} (${n.hit_dice})
`),n.speed&&(t+=`Speed: ${JSON.stringify(n.speed)}
`),n.strength&&(t+=`Stats: STR ${n.strength}, DEX ${n.dexterity}, CON ${n.constitution}, INT ${n.intelligence}, WIS ${n.wisdom}, CHA ${n.charisma}
`),n.skills&&Object.keys(n.skills).length>0&&(t+=`Skills: ${JSON.stringify(n.skills)}
`),n.senses&&(t+=`Senses: ${n.senses}
`),n.languages&&(t+=`Languages: ${n.languages}
`),n.challenge_rating&&(t+=`CR: ${n.challenge_rating}
`);const e=pe(n.special_abilities);e&&(t+=`Abilities:
${e}
`);const o=pe(n.actions);o&&(t+=`Actions:
${o}
`);const i=pe(n.legendary_actions);return i&&(t+=`Legendary Actions:
${i}
`),t}function Ed(n){let t=`Type: Background
Name: ${n.name}
`;n.desc&&(t+=`Description: ${k(n.desc)}
`);const e=pe(n.benefits);return e&&(t+=`Benefits:
${e}
`),t}function vd(n){let t=`Type: Feat
Name: ${n.name}
`;return n.prerequisite&&(t+=`Prerequisite: ${n.prerequisite}
`),n.desc&&(t+=`Description: ${k(n.desc)}
`),t}function Sd(n){return`Type: Condition
Name: ${n.name}
Description: ${k(n.desc)}
`}function Id(n){let t=`Type: Race
Name: ${n.name}
`;n.desc&&(t+=`Description: ${k(n.desc)}
`);const e=pe(n.traits);return e&&(t+=`Traits:
${e}
`),t}function Ad(n){let t=`Type: Class
Name: ${n.name}
`;if(n.hit_dice&&(t+=`Hit Dice: ${n.hit_dice}
`),n.prof_armor&&(t+=`Armor Proficiencies: ${n.prof_armor}
`),n.prof_weapons&&(t+=`Weapon Proficiencies: ${n.prof_weapons}
`),n.prof_tools&&(t+=`Tool Proficiencies: ${n.prof_tools}
`),n.prof_saving_throws&&(t+=`Saving Throw Proficiencies: ${n.prof_saving_throws}
`),n.prof_skills&&(t+=`Skill Proficiencies: ${n.prof_skills}
`),n.archetypes){const e=n.archetypes.map(o=>`
---
Subclass: ${o.name}
${k(o.desc)}
---
`).join("");t+=`
Subclasses:
${e}`}return t}function _d(n){let t=`Type: Magic Item
Name: ${n.name}
`;return n.type&&(t+=`Item Type: ${n.type}
`),n.rarity&&(t+=`Rarity: ${n.rarity}
`),n.requires_attunement&&(t+=`Requires Attunement: ${n.requires_attunement}
`),n.desc&&(t+=`Description: ${k(n.desc)}
`),t}function Md(n){let t=`Type: Weapon
Name: ${n.name}
`;n.category&&(t+=`Category: ${n.category}
`),n.damage_dice&&(t+=`Damage: ${n.damage_dice}
`);const e=ei(n.properties);return e&&(t+=`Properties: ${e}
`),t}function wd(n){let t=`Type: Armor
Name: ${n.name}
`;return n.category&&(t+=`Category: ${n.category}
`),n.ac_display&&(t+=`AC: ${n.ac_display}
`),t}function Un(n){return`Type: Lore
Topic: ${n.name}
Content: ${k(n.desc)}
`}function Rd(n){return`Type: Spell List
Class: ${n.name}
Spells: ${ei(n.spells)}`}const xd={spells:Td,monsters:Cd,backgrounds:Ed,feats:vd,conditions:Sd,races:Id,classes:Ad,magicitems:_d,weapons:Md,armor:wd,planes:Un,sections:Un,spelllist:Rd};function Pd(n,t){const e=xd[t];if(e)return e(n);console.warn(`No chunking strategy found for type: ${t}. Using fallback.`);let o=`Type: ${t}
Name: ${n.name||n.slug}
`;return n.desc&&(o+=`Description: ${k(n.desc)}
`),o}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let Z=null,ot=null,H=[],Le=null,be="idle";const Nd="UnfetteredRagStore",Dd=1,le="vectors",kd={spells:"data/spells.json",monsters:"data/monsters.json",backgrounds:"data/backgrounds.json",feats:"data/feats.json",conditions:"data/conditions.json",races:"data/races.json",classes:"data/classes.json",magicitems:"data/magicitems.json",weapons:"data/weapons.json",armor:"data/armor.json",planes:"data/planes.json",sections:"data/sections.json",spelllist:"data/spelllist.json"};function R(n,t){be=n,ot&&ot(be,t)}function Ld(){return new Promise((n,t)=>{const e=indexedDB.open(Nd,Dd);e.onupgradeneeded=o=>{const i=o.target.result;i.objectStoreNames.contains(le)||i.createObjectStore(le,{keyPath:"id",autoIncrement:!0})},e.onsuccess=o=>n(o.target.result),e.onerror=o=>t(`IndexedDB error: ${o.target.error}`)})}function bd(n,t){const e=n.reduce((a,l,c)=>a+l*t[c],0),o=Math.sqrt(n.reduce((a,l)=>a+l*l,0)),i=Math.sqrt(t.reduce((a,l)=>a+l*l,0));return o===0||i===0?0:e/(o*i)}async function ti(n,t){if(Z=n,ot=t,R("initializing"),!Z.supportsEmbeddings()){R("unsupported");return}try{Le=await Ld();const i=Le.transaction(le,"readonly").objectStore(le).getAll();i.onsuccess=()=>{H=i.result,H.length>0?R("ready",`${H.length} documents loaded from cache.`):R("idle")},i.onerror=()=>{R("error","Could not load knowledge base from cache.")}}catch(e){console.error("RAG init failed:",e),R("error","Failed to initialize database.")}}async function Ud(){if(!Z||!Le)return R("error","Service not initialized.");if(!Z.supportsEmbeddings())return R("unsupported");R("building","Loading data from local files...");const n=[];for(const[t,e]of Object.entries(kd)){R("building",`Loading ${t}...`);try{const o=await fetch(e);if(!o.ok){console.error(`Failed to fetch ${e}: ${o.statusText}`),R("error",`Could not find ${t}.json. Ensure it exists in a /data directory.`);return}const i=await o.json(),a=Array.isArray(i)?i:i.results;if(!a){console.warn(`No valid data array found in ${e}. Skipping.`);continue}let l=a;t==="documents"?l=a.filter(c=>{var d;return!((d=c.slug)!=null&&d.includes("eberron"))}):l=a.filter(c=>{var d;return!((d=c.document__slug)!=null&&d.includes("eberron"))});for(const c of l)n.push({chunk:Pd(c,t),metadata:{source:t,name:c.name||c.slug}})}catch(o){console.error(`Error loading or processing ${e}:`,o),R("error",`Could not load or parse ${t}.json.`);return}}if(n.length===0)return R("error","Failed to load any data from local files.");R("building",`Generating embeddings for ${n.length} documents...`);try{const t=await Z.batchEmbedContents(n.map(i=>i.chunk));R("building","Saving to database...");const e=Le.transaction(le,"readwrite"),o=e.objectStore(le);o.clear(),H=[],t.forEach((i,a)=>{const l={chunk:n[a].chunk,embedding:i,metadata:n[a].metadata};o.add(l),H.push({...l,id:a+1})}),e.oncomplete=()=>{R("ready",`${n.length} documents indexed successfully.`)},e.onerror=()=>{R("error","Failed to save knowledge base to database.")}}catch(t){console.error("Embedding generation failed:",t),R("error",`Failed to generate embeddings: ${t}`)}}async function Vd(n,t=3){if(be!=="ready"||!Z||H.length===0)return[];try{const e=(await Z.batchEmbedContents([n]))[0],o=H.map(i=>({...i,score:bd(e,i.embedding)}));return o.sort((i,a)=>a.score-i.score),o.slice(0,t)}catch(e){return console.error("RAG search failed:",e),[]}}function Gd(){return be==="ready"&&H.length>0}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Fd(n){if(!n||typeof n!="object")return!1;const t=e=>Object.prototype.hasOwnProperty.call(n,e);return t("level")&&typeof n.level=="number"&&t("health")&&typeof n.health=="object"&&t("abilityScores")&&t("skills")&&t("savingThrows")}async function Vn(n,t){const e=Ke();if(e.provider==="gemini"&&!e.apiKey){fe(e);return}if(e.provider==="local"&&!e.localUrl){fe(e);return}try{const l=Zo(e);v.updateState({llmProvider:l}),ti(l,Ct)}catch(l){console.error("Failed to initialize LLM Provider",l),alert(`There was an error initializing the AI provider. Please check your configuration in Settings. Error: ${l}`),fe(e);return}const o=localStorage.getItem("matureEnabled")==="true",i=localStorage.getItem("readAloudEnabled")==="true";v.updateState({isMatureEnabled:o}),Mt.checked=o,b.init(i,e),jo.init(l=>{me.value=l},l=>{N("error",`Mic error: ${l}`)});const a=()=>{if(t(),_e.classList.add("hidden"),n==="new")st.classList.remove("hidden"),ni(o);else if(n==="load"){const l=he();er(l)}};localStorage.getItem("ageConfirmed")!=="true"?(_t.classList.remove("hidden"),pi.addEventListener("click",()=>{const l=Mt.checked;localStorage.setItem("ageConfirmed","true"),localStorage.setItem("matureEnabled",String(l)),_t.classList.add("hidden"),a()},{once:!0})):a()}function $d(n){n.preventDefault();const t=Me.value,e=Ye.value.trim(),o=Hn.value.trim(),i={provider:t,apiKey:e,localUrl:o};ur(i),$n.classList.add("hidden");try{const a=Zo(i);v.updateState({llmProvider:a}),ti(a,Ct);const l=localStorage.getItem("readAloudEnabled")==="true";b.init(l,i)}catch(a){alert(`Settings saved, but there was an error initializing the provider: ${a}`)}}function Bd(n){ai.addEventListener("click",()=>Vn("new",n)),li.addEventListener("click",()=>Vn("load",n)),ci.addEventListener("click",()=>fe(Ke())),yi.addEventListener("click",()=>fe(Ke())),fi.addEventListener("submit",$d),Me.addEventListener("change",()=>{const t=Me.value==="local";Bn.classList.toggle("hidden",t),qn.classList.toggle("hidden",!t)}),Ii.addEventListener("click",()=>{ue.classList.remove("hidden")}),Ai.addEventListener("click",()=>{ue.classList.add("hidden")}),ue.addEventListener("click",t=>{t.target===ue&&ue.classList.add("hidden")})}async function qd(){v.getState().llmProvider?await Ud():Ct("error","AI Provider not initialized.")}function Gn(){return{speech:jo,tts:b}}async function Be(){const{llmProvider:n,isMatureEnabled:t,characterInfo:e,playerState:o,chatHistory:i}=v.getState();if(!n||!e||!o)throw new Error("Cannot initialize chat: core state missing.");b.cancel();try{const a=await n.createChatSession(e,o,t,i);v.updateState({chat:a})}catch(a){throw console.error("Failed to create chat session:",a),N("error",`Failed to initialize the Storyteller. Please check your AI Provider settings. Error: ${a}`),a}}function ni(n){if(b.cancel(),v.resetForNewGame(),v.updateState({isMatureEnabled:n}),F.innerHTML="",ji(),!v.getState().llmProvider){N("error","AI provider is not initialized. Please configure it in Settings.");return}ri(),tr()}function Hd(){const{playerState:n,characterInfo:t,currentCharacterId:e,chatHistory:o,llmProvider:i}=v.getState();!n||!t||!e||!i||dr(e,{playerState:n,characterInfo:t,chatHistory:o,currentModelIndex:i.getCurrentModelIndex()})}async function Od(n){var o;const t=he().find(i=>i.id===n);if(!t){N("error","Could not find the selected save file.");return}if(!Fd(t.playerState)||!t.characterInfo){alert(`The save file for "${((o=t.characterInfo)==null?void 0:o.name)||"Unknown"}" appears corrupted.`);return}const{llmProvider:e}=v.getState();e&&e.setCurrentModelIndex(t.currentModelIndex||0),v.updateState({currentCharacterId:t.id,isMatureEnabled:localStorage.getItem("matureEnabled")==="true",characterInfo:t.characterInfo,playerState:t.playerState,chatHistory:t.chatHistory});try{await Be()}catch{return}Tt(t.playerState,t.characterInfo),F.innerHTML="",t.chatHistory.forEach(i=>{const a=i.parts.map(c=>c.text).join(""),l=i.role==="user"?"user":"dm";N(l,Ae(a))}),Ue(),we.classList.add("hidden"),_e.classList.add("hidden"),st.classList.remove("hidden")}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */async function j(n,t,e){const{isGenerating:o,characterInfo:i,playerState:a,llmProvider:l}=v.getState();if(o||!i||!a||!l)return;if(t){const d=[...v.getState().chatHistory,{role:"user",parts:[{text:t}]}];v.updateState({chatHistory:d})}Pe(!0),v.updateState({isGenerating:!0});let c=e;c||(c=N("dm",""));try{const{chat:d}=v.getState();if(!d)throw new Error("Chat not initialized.");const u=d.sendMessageStream({message:n}),f=await ve(u,3e4,"The storyteller took too long to respond. The request timed out.");await Yd(f,c)}catch(d){console.error("API call failed:",d);const u=(d.message||String(d)).toLowerCase();if((u.includes("resource_exhausted")||u.includes("429"))&&u.includes("quota")&&l)if(await l.useNextModel()){const m=l.getCurrentModel();c.innerHTML=`<em>Quota exceeded for the current model. Switching to fallback: ${m}. Retrying...</em>`,await Be(),await j(n,"",c);return}else c.innerHTML="API quota exceeded, and no fallback models are available. Please check your plan and billing details.",c.classList.add("error-message");else c.innerHTML=`There was an error with the AI provider. Please check your Settings and the console for details. Error: ${d.message||d}`,c.classList.add("error-message");Pe(!1),v.updateState({isGenerating:!1})}}async function Yd(n,t){let e="",o="";for await(const a of n){const l=a.text;if(l===void 0){console.warn("Received undefined text chunk from stream.");continue}e+=l,o+=l;const c=Ae(e);t.innerHTML=c.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"),Ue();let d;for(;(d=o.search(/[.!?]\s/))!==-1;){const u=o.substring(0,d+1);o=o.substring(d+2),b.queue(Ae(u))}}o.trim()&&b.queue(Ae(o.trim()));const i=[...v.getState().chatHistory,{role:"model",parts:[{text:e}]}];v.updateState({chatHistory:i}),await Jd(e)}async function Jd(n){var u;let t=!1;const{isMatureEnabled:e,playerState:o,characterInfo:i}=v.getState(),a=n.match(ut);if(a&&a[1])try{const f=JSON.parse(a[1]);v.updatePlayerState(f),t=!0}catch(f){console.error("Failed to parse player state JSON:",f)}if(e&&o&&i){if(Re.test(n)&&i.gender==="female"&&!((u=o.pregnancy)!=null&&u.isPregnant)&&Math.random()<xi){const f=n.match(Re);f&&(v.updatePlayerState({pregnancy:{isPregnant:!0,conceptionTurn:o.turnCount,sire:f[1],knowledgeRevealed:!1}}),N("dm","<em>A subtle change, a feeling deep within... something is different.</em>"),t=!0)}dt.test(n)&&o.pregnancy&&!o.pregnancy.knowledgeRevealed&&(v.updatePlayerState({pregnancy:{...o.pregnancy,knowledgeRevealed:!0}}),t=!0)}t&&(Tt(v.getState().playerState,v.getState().characterInfo),Hd(),await Be()),document.querySelectorAll(".action-btn-container, .roll-request-container").forEach(f=>f.remove());const l=[...n.matchAll(ct)],c=[...n.matchAll(lt)],d=[];if(l.forEach(f=>d.push({type:"attack",weaponName:f[1],targetDescription:f[2],modifier:f[3]})),c.forEach(f=>d.push({type:"roll",skillOrAbility:f[1],description:f[2],modifier:f[3]})),d.length===1){const f=d[0];f.type==="attack"?await oi(f.weaponName,f.targetDescription,f.modifier):await St(f.skillOrAbility,f.description,f.modifier)}else if(d.length>1)ir(d),Pe(!0,!1),v.updateState({isGenerating:!1});else{Pe(!1),v.updateState({isGenerating:!1}),me.focus();const f=F.querySelector(".dm-message:last-child");f&&rr(f)}}async function oi(n,t,e){const{playerState:o}=v.getState();if(!o)return;const i=$i(n);if(!i){await j(`(Attack failed: Weapon '${n}' not found.)`,`(Attack failed: Weapon '${n}' not found.)`);return}const a=i.is_finesse&&o.abilityScores.dexterity>o.abilityScores.strength?"dexterity":"strength",l=$(o.abilityScores[a])+o.proficiencyBonus;let c=Math.floor(Math.random()*20)+1,d=Math.floor(Math.random()*20)+1,u=e==="ADVANTAGE"?Math.max(c,d):e==="DISADVANTAGE"?Math.min(c,d):c;const f=u===20,p=i.damage_dice;let m=xt(p).total+(f?xt(p).total:0);const h=$(o.abilityScores[a]),g={description:`Attack with ${n} on ${t}`,weaponName:n,attackRoll:u,attackBonus:l,totalAttackRoll:u+l,damageRoll:m,damageBonus:h,totalDamage:Math.max(1,m+h),damageDice:p,isCritical:f,allRolls:e==="ADVANTAGE"||e==="DISADVANTAGE"?[c,d]:[c],rollModifier:e};N("attack",g);const T=`(Attack with ${n}: rolled ${u} + ${l} = ${g.totalAttackRoll}. Damage: ${m} + ${h} = ${g.totalDamage}. ${f?"Critical Hit!":""})`;await j(T,T)}async function St(n,t,e){const{playerState:o}=v.getState();if(!o)return;const i=qi(n,o);let a=Math.floor(Math.random()*20)+1,l=Math.floor(Math.random()*20)+1,c=e==="ADVANTAGE"?Math.max(a,l):e==="DISADVANTAGE"?Math.min(a,l):a;const d={description:t,roll:c,modifier:i,total:c+i,dieValue:20,diceString:`d20+${i}`,skillOrAbility:n,allRolls:e==="ADVANTAGE"||e==="DISADVANTAGE"?[a,l]:[a],rollModifier:e};N("dice",d);const u=`(Dice roll for "${t}" (${n}): rolled ${c} + ${i} = ${d.total})`;await j(u,u)}async function Kd(n){var o;n.preventDefault();const t=me.value.trim();if(!t||v.getState().isGenerating)return;b.cancel(),N("user",t),me.value="",v.updatePlayerState({turnCount:(((o=v.getState().playerState)==null?void 0:o.turnCount)||0)+1});let e=t;if(Gd()){const i=await Vd(t);i.length>0&&(e=`(Use the following background information...)
${i.map(l=>l.chunk).join(`
---
`)}

My action is: ${t}`)}await j(e,t)}async function it(n){var o;Jn.classList.add("hidden"),Kn.reset();const t=`My adventure begins with this scenario: ${n}`,e=N("dm","<em>Your adventure begins...</em>");v.updatePlayerState({turnCount:(((o=v.getState().playerState)==null?void 0:o.turnCount)||0)+1}),await j(t,t,e)}async function Wd(n){var u,f,p;if(v.getState().isGenerating)return;b.cancel();const t=n.closest(".dice-roll-message");if(!t)return;const{skillOrAbility:e,description:o,modifier:i}=t.dataset;if(!e||!o)return;const a=Array.from(F.children),l=a.indexOf(t);(u=a[l])==null||u.remove(),(f=a[l+1])==null||f.remove(),(p=n.parentElement)==null||p.remove();const d=v.getState().chatHistory.slice(0,-2);v.updateState({chatHistory:d}),await St(e,o,i)}async function zd(n){var l,c;if(v.getState().isGenerating)return;b.cancel();const t=(l=n.parentElement)==null?void 0:l.previousElementSibling;if(!t||!t.classList.contains("dm-message"))return;(c=n.parentElement)==null||c.remove();const e=v.getState().chatHistory,o=e[e.length-2],i=e.slice(0,-1);if(v.updateState({chatHistory:i}),!o||o.role!=="user")return;const a=o.parts.map(d=>d.text).join("");await j(a,a,t)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xd={strength:"str",dexterity:"dex",constitution:"con",intelligence:"int",wisdom:"wis",charisma:"cha"},rt=40;let L={pointsRemaining:rt,scores:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10}};function Oe(){const n=document.getElementById("skill-selection-container");if(!n)return;n.innerHTML="";const t=ie.value,e=re.value,o=se.value,i=new Set,a=[];if([{name:t,data:gt(t)},{name:o,data:yt(o)},{name:e,data:ht(e)}].forEach((c,d)=>{var u,f;(f=(u=c.data)==null?void 0:u.skill_proficiencies)==null||f.forEach(p=>{p.type==="granted"?p.from.forEach(m=>i.add(m)):p.type==="choice"&&a.push({source:c.data.name,choose:p.choose,from:p.from,groupName:`skill-choice-group-${d}`})})}),i.size>0){let c='<div class="skill-choice-block"><h5>Skills Granted Automatically</h5><div class="skill-choice-grid">';i.forEach(d=>{c+=`<div class="skill-checkbox"><input type="checkbox" id="skill-granted-${d}" value="${d}" checked disabled><label for="skill-granted-${d}">${d}</label></div>`}),c+="</div></div>",n.innerHTML+=c}a.forEach(c=>{let d=`<div class="skill-choice-block"><h5>${c.source} Skills (Choose ${c.choose})</h5><div class="skill-choice-grid">`;c.from.forEach(u=>{d+=`
                <div class="skill-checkbox">
                    <input type="checkbox" id="${c.groupName}-${u}" name="${c.groupName}" value="${u}">
                    <label for="${c.groupName}-${u}">${u}</label>
                </div>
            `}),d+="</div></div>",n.innerHTML+=d}),ii()}function ii(){const n=document.getElementById("skill-selection-container");if(!n)return;const t=ie.value,e=re.value,o=se.value,i=new Set,a=[];[{name:t,data:gt(t)},{name:o,data:yt(o)},{name:e,data:ht(e)}].forEach((u,f)=>{var p;u.data&&((p=u.data.skill_proficiencies)==null||p.forEach(m=>{m.type==="granted"?m.from.forEach(h=>i.add(h)):m.type==="choice"&&a.push({source:u.data.name,choose:m.choose,from:m.from,groupName:`skill-choice-group-${f}`})}))});const c=new Set(i);n.querySelectorAll('input[type="checkbox"][id^="skill-choice-"]:checked').forEach(u=>{c.add(u.value)});const d=Array.from(n.querySelectorAll('input[type="checkbox"][id^="skill-choice-"]'));d.forEach(u=>{u.disabled=!1}),a.forEach(u=>{const f=d.filter(m=>m.name===u.groupName);f.filter(m=>m.checked).length>=u.choose&&f.forEach(m=>{m.checked||(m.disabled=!0)})}),d.forEach(u=>{!u.checked&&c.has(u.value)&&(u.disabled=!0)})}function ri(){L={pointsRemaining:rt,scores:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10}};let n=0;for(const t of Object.values(L.scores))n+=xe(t);L.pointsRemaining=rt-n,si()}function si(){_i.textContent=String(L.pointsRemaining);for(const[n,t]of Object.entries(L.scores)){const e=Xd[n];document.getElementById(`${n}-score`).textContent=String(t),document.getElementById(`${n}-cost`).textContent=String(xe(t)),document.getElementById(`${e}-decrease`).disabled=t<=8,document.getElementById(`${e}-increase`).disabled=t>=20}}function Qd(n,t){const e=L.scores[n],o=t==="increase"?e+1:e-1;if(o<8||o>20)return;const i=xe(e),l=xe(o)-i;t==="increase"&&L.pointsRemaining<l||(L.scores[n]=o,L.pointsRemaining-=l,si())}async function Zd(n){var f,p;n.preventDefault();const{isGenerating:t,llmProvider:e}=v.getState();if(t||!e)return;const o={name:Yn.value.trim(),desc:Ti.value.trim(),bio:Ci.value.trim(),race:ie.value,characterClass:re.value,background:se.value,alignment:vi.value.trim(),gender:Si.value};if(!o.name||!o.race||!o.characterClass||!o.background||!o.alignment||!o.gender){alert("Please fill in all required character details.");return}const i=ht(o.characterClass),a=gt(o.race),l=yt(o.background);if(!i||!a||!l){alert("Error: Could not find rules data for selected options.");return}const c=Hi(o);for(const m in c.abilityScores){const h=L.scores[m];c.abilityScores[m]=h+(((f=a.ability_bonuses)==null?void 0:f[m])||0)}c.health.max=(i.hit_die||8)+$(c.abilityScores.constitution),c.health.current=c.health.max;const d=Yi(o.characterClass),u=Ji(l);c.equipment=d.equipment,c.inventory=[...new Set([...d.inventory,...u])],c.armorClass=Bi(c),(i.prof_saving_throws||"").toLowerCase().split(", ").forEach(m=>{m in c.savingThrows&&(c.savingThrows[m]="proficient")}),c.racialTraits=a.traits.map(m=>m.name).filter(m=>!["Ability Score Increase","Age","Alignment","Size","Speed","Languages"].includes(m)),c.classFeatures=Oi(i),(p=l.benefits)==null||p.forEach(m=>{m.type==="feature"&&c.classFeatures.push(m.name)}),document.querySelectorAll('#skill-selection-container input[type="checkbox"]:checked').forEach(m=>{const h=lr(m.value);h in c.skills&&(c.skills[h]="proficient")}),v.updateState({characterInfo:o,playerState:c}),Tt(c,o),at.classList.add("hidden"),On.reset(),ri(),Jn.classList.remove("hidden"),ne.innerHTML='<div class="spinner-container"><div class="spinner"></div><span>Generating creative story ideas...</span></div>';try{const m=await e.createStoryHooks(o,c),h=Array.isArray(m)?m:m.storyHooks||[];Pt(h,it);const g=Date.now().toString();v.updateState({currentCharacterId:g}),bo({id:g,characterInfo:o,playerState:c,chatHistory:[],currentModelIndex:0}),await Be()}catch(m){console.error("Failed to generate story hooks:",m),N("error","The storyteller had trouble coming up with story ideas. You can write your own below to start!"),Pt([],it)}}function jd(n){n.preventDefault();const t=Ei.value.trim();t&&it(t)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ef(){On.addEventListener("submit",Zd),Kn.addEventListener("submit",jd),mi.addEventListener("click",()=>{we.classList.add("hidden"),ni(localStorage.getItem("matureEnabled")==="true")}),hi.addEventListener("click",()=>{we.classList.add("hidden"),_e.classList.remove("hidden")}),gi.addEventListener("click",()=>{at.classList.add("hidden"),st.classList.add("hidden"),_e.classList.remove("hidden")}),Mi.addEventListener("click",t=>{const o=t.target.closest(".stat-btn");if(!o)return;const i=o.dataset.stat,a=o.id.includes("increase")?"increase":"decrease";Qd(i,a)}),F.addEventListener("click",async t=>{var a;const e=t.target,o=e.closest(".action-choice-btn");if(o){const{actionType:l,weaponName:c,targetDescription:d,skillOrAbility:u,description:f,modifier:p}=o.dataset;(a=o.parentElement)==null||a.remove(),l==="attack"?await oi(c,d,p):l==="roll"&&await St(u,f,p);return}const i=e.closest(".action-btn");i&&(i.classList.contains("reroll-btn")?await Wd(i):i.classList.contains("regenerate-btn")&&await zd(i))}),te.addEventListener("click",async t=>{const e=t.target.closest("button");if(!e)return;const{id:o}=e.dataset;if(!o)return;const i=e.closest(".save-slot-card");e.classList.contains("load-btn")?await Od(o):e.classList.contains("delete-btn")&&fr(o)&&(i&&i.remove(),te.children.length===0&&(te.innerHTML='<p class="no-saves">No adventures saved yet. Time to start one!</p>'))}),Fn.addEventListener("submit",Kd),q.addEventListener("click",()=>{const{speech:t,tts:e}=Gn();t.toggle(e.cancel)}),z.addEventListener("change",()=>{const t=z.checked;Gn().tts.setEnabled(t),localStorage.setItem("readAloudEnabled",String(t))}),Ee.addEventListener("click",qd),wt.addEventListener("click",t=>{const o=t.target.closest(".accordion-header");if(!o)return;wt.querySelectorAll(".accordion-header").forEach(l=>{if(l!==o){l.classList.remove("active");const c=l.nextElementSibling;c&&c.classList.contains("accordion-content")&&c.classList.remove("expanded")}}),o.classList.toggle("active");const a=o.nextElementSibling;a&&a.classList.contains("accordion-content")&&a.classList.toggle("expanded")}),ie.addEventListener("change",Oe),re.addEventListener("change",Oe),se.addEventListener("change",Oe);const n=document.getElementById("skill-selection-container");n&&n.addEventListener("change",t=>{const e=t.target;e&&e.type==="checkbox"&&e.id.startsWith("skill-choice-")&&ii()})}async function tf(){const n="436f707972696768742028632920323032352054686553756c66617465466f726765";ui.textContent=ar(n),await bi(),nr(),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>console.log("SW registered.",t),t=>console.log("SW reg failed: ",t))}),Bd(ef)}tf();
